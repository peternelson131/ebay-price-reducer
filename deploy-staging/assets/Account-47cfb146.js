import{j as e,u as k,a as T,s as M}from"./index-0231291c.js";import{h as U,r as n}from"./vendor-react-4c62d1cf.js";import{u as B,b as Q,c as z}from"./vendor-query-4b12add6.js";import"./vendor-supabase-5edd3635.js";function Y(){const[P,$]=U(),[l,f]=n.useState("profile"),[i,g]=n.useState(!1),[u,h]=n.useState({}),[d,y]=n.useState(!1),[j,v]=n.useState({}),[o,x]=n.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[r,p]=n.useState({category:"",description:"",screenshot:null}),[w,m]=n.useState({type:"",message:""}),[_,S]=n.useState(!1),C=B(),{data:s,isLoading:E}=Q(["profile"],()=>k.getProfile(),{refetchOnWindowFocus:!1});n.useEffect(()=>{s&&!i&&h({name:s.name||"",default_reduction_strategy:s.default_reduction_strategy||"fixed_percentage",default_reduction_percentage:s.default_reduction_percentage||5,default_reduction_interval:s.default_reduction_interval||7})},[s,i]),n.useEffect(()=>{s&&!d&&v({email_notifications:s.email_notifications??!0,price_reduction_alerts:s.price_reduction_alerts??!0})},[s,d]),n.useEffect(()=>{const t=P.get("tab");t&&["profile","preferences","security","feedback"].includes(t)&&f(t)},[P]);const N=z({mutationFn:t=>k.updateProfile(t),onSuccess:()=>{C.invalidateQueries(["profile"]),g(!1)}}),A=async()=>{N.mutate(u)},I=async()=>{try{await k.updateProfile(j),C.invalidateQueries(["profile"]),y(!1)}catch(t){console.error("Failed to update preferences:",t),alert("Failed to update preferences. Please try again.")}},R=async t=>{if(t.preventDefault(),o.newPassword!==o.confirmPassword){alert("New passwords do not match");return}if(o.newPassword.length<8){alert("Password must be at least 8 characters");return}try{await T.updatePassword(o.newPassword),alert("Password updated successfully!"),x({currentPassword:"",newPassword:"",confirmPassword:""})}catch(a){console.error("Password update failed:",a),alert("Failed to update password. Please try again.")}},q=async()=>{window.confirm("Are you sure you want to delete your account? This action cannot be undone.")&&window.confirm("This will permanently delete all your listings and data. Are you absolutely sure?")&&alert("Account deletion would be processed. In demo mode, this is simulated.")},L=()=>{const t={profile:s,exportDate:new Date().toISOString(),listings:"Available",priceHistory:"Available"},a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),c=URL.createObjectURL(a),b=document.createElement("a");b.href=c,b.download="ebay-price-reducer-data.json",b.click(),URL.revokeObjectURL(c)},O=async t=>{if(t.preventDefault(),m({type:"",message:""}),!r.category){m({type:"error",message:"Please select a category."});return}if(!r.description.trim()){m({type:"error",message:"Please provide a description."});return}if(r.category==="bug"&&!r.screenshot){m({type:"error",message:"Screenshot is required for bug reports."});return}S(!0);try{const{data:{session:a}}=await M.auth.getSession();if(!(a!=null&&a.access_token))throw new Error("Not authenticated");const c=new FormData;if(c.append("category",r.category),c.append("description",r.description),r.screenshot&&c.append("screenshot",r.screenshot),!(await fetch("/.netlify/functions/submit-feedback",{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`},body:c})).ok)throw new Error("Failed to submit feedback");m({type:"success",message:"Thank you! Your feedback has been submitted successfully."}),p({category:"",description:"",screenshot:null});const D=document.getElementById("screenshot-input");D&&(D.value="")}catch(a){console.error("Feedback submission failed:",a),m({type:"error",message:"Failed to submit feedback. Please try again."})}finally{S(!1)}};if(E)return e.jsx("div",{className:"text-center py-8",children:"Loading..."});const F=[{id:"profile",name:"Profile",icon:"ðŸ‘¤"},{id:"preferences",name:"Preferences",icon:"âš™ï¸"},{id:"security",name:"Security",icon:"ðŸ”’"},{id:"feedback",name:"Feedback",icon:"ðŸ’¬"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-theme-primary",children:"Account Settings"}),e.jsx("p",{className:"text-theme-secondary mt-2",children:"Manage your account settings and preferences"})]}),e.jsxs("div",{className:"bg-theme-surface rounded-lg border border-theme overflow-hidden",children:[e.jsx("div",{className:"sm:hidden",children:e.jsx("select",{value:l,onChange:t=>f(t.target.value),className:"w-full px-4 py-3 text-base border-b border-theme focus:outline-none focus:ring-2 focus:ring-blue-500",children:F.map(t=>e.jsxs("option",{value:t.id,children:[t.icon," ",t.name]},t.id))})}),e.jsx("div",{className:"hidden sm:block border-b border-theme",children:e.jsx("nav",{className:"flex flex-wrap","aria-label":"Tabs",children:F.map(t=>e.jsxs("button",{onClick:()=>f(t.id),className:`${l===t.id?"border-blue-500 text-accent bg-accent/10":"border-transparent text-theme-tertiary hover:text-theme-secondary hover:border-theme"} whitespace-nowrap py-4 px-4 sm:px-6 border-b-2 font-medium text-sm flex items-center space-x-2 transition-colors`,children:[e.jsx("span",{className:"text-lg",children:t.icon}),e.jsx("span",{className:"hidden md:inline",children:t.name})]},t.id))})}),e.jsxs("div",{className:"p-4 sm:p-6",children:[l==="profile"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-theme-primary",children:"Profile Information"}),e.jsx("p",{className:"text-sm text-theme-secondary",children:"Update your account profile information."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:"Full Name"}),i?e.jsx("input",{type:"text",value:u.name||(s==null?void 0:s.name)||"",onChange:t=>h(a=>({...a,name:t.target.value})),className:"w-full border border-theme rounded-lg px-3 py-2"}):e.jsx("div",{className:"text-theme-primary",children:(s==null?void 0:s.name)||"Not set"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:"Email"}),e.jsx("div",{className:"text-theme-primary",children:(s==null?void 0:s.email)||"Not set"})]})]}),e.jsxs("div",{className:"border-t border-theme pt-4",children:[e.jsx("h4",{className:"text-md font-medium text-theme-primary mb-3",children:"Default Reduction Settings"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:"Strategy"}),i?e.jsxs("select",{value:u.default_reduction_strategy||"fixed_percentage",onChange:t=>h(a=>({...a,default_reduction_strategy:t.target.value})),className:"w-full border border-theme rounded-lg px-3 py-2",children:[e.jsx("option",{value:"fixed_percentage",children:"Fixed Percentage"}),e.jsx("option",{value:"fixed_amount",children:"Fixed Amount"})]}):e.jsx("div",{className:"text-theme-primary capitalize",children:((s==null?void 0:s.default_reduction_strategy)||"fixed_percentage").replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:"Reduction %"}),i?e.jsx("input",{type:"number",value:u.default_reduction_percentage||5,onChange:t=>h(a=>({...a,default_reduction_percentage:parseFloat(t.target.value)})),className:"w-full border border-theme rounded-lg px-3 py-2",min:"0",max:"100",step:"0.5"}):e.jsxs("div",{className:"text-theme-primary",children:[(s==null?void 0:s.default_reduction_percentage)||5,"%"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:"Interval (days)"}),i?e.jsx("input",{type:"number",value:u.default_reduction_interval||7,onChange:t=>h(a=>({...a,default_reduction_interval:parseInt(t.target.value)})),className:"w-full border border-theme rounded-lg px-3 py-2",min:"1",max:"365"}):e.jsxs("div",{className:"text-theme-primary",children:[(s==null?void 0:s.default_reduction_interval)||7," days"]})]})]})]}),e.jsx("div",{className:"flex gap-3",children:i?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A,disabled:N.isLoading,className:"bg-accent text-white px-4 py-2 rounded hover:bg-accent-hover disabled:opacity-50",children:N.isLoading?"Saving...":"Save Changes"}),e.jsx("button",{onClick:()=>g(!1),className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",children:"Cancel"})]}):e.jsx("button",{onClick:()=>g(!0),className:"bg-accent text-white px-4 py-2 rounded hover:bg-accent-hover",children:"Edit Profile"})})]}),l==="preferences"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-theme-primary",children:"Notification Preferences"}),e.jsx("p",{className:"text-sm text-theme-secondary",children:"Manage how you receive notifications."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-theme-primary",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-theme-secondary",children:"Receive email updates about your account"})]}),e.jsx("input",{type:"checkbox",checked:d?j.email_notifications:(s==null?void 0:s.email_notifications)??!0,onChange:t=>v(a=>({...a,email_notifications:t.target.checked})),disabled:!d,className:"h-4 w-4 text-accent focus:ring-accent border-theme rounded"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-theme-primary",children:"Price Reduction Alerts"}),e.jsx("p",{className:"text-sm text-theme-secondary",children:"Get notified when prices are automatically reduced"})]}),e.jsx("input",{type:"checkbox",checked:d?j.price_reduction_alerts:(s==null?void 0:s.price_reduction_alerts)??!0,onChange:t=>v(a=>({...a,price_reduction_alerts:t.target.checked})),disabled:!d,className:"h-4 w-4 text-accent focus:ring-accent border-theme rounded"})]})]}),e.jsx("div",{className:"flex gap-3",children:d?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:I,className:"bg-accent text-white px-4 py-2 rounded hover:bg-accent-hover",children:"Save Preferences"}),e.jsx("button",{onClick:()=>y(!1),className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",children:"Cancel"})]}):e.jsx("button",{onClick:()=>y(!0),className:"bg-accent text-white px-4 py-2 rounded hover:bg-accent-hover",children:"Edit Preferences"})})]}),l==="security"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-theme-primary",children:"Security Settings"}),e.jsx("p",{className:"text-sm text-theme-secondary",children:"Manage your password and security options."})]}),e.jsxs("form",{onSubmit:R,className:"space-y-4 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:"Current Password"}),e.jsx("input",{type:"password",value:o.currentPassword,onChange:t=>x(a=>({...a,currentPassword:t.target.value})),className:"w-full border border-theme rounded-lg px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:"New Password"}),e.jsx("input",{type:"password",value:o.newPassword,onChange:t=>x(a=>({...a,newPassword:t.target.value})),className:"w-full border border-theme rounded-lg px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:o.confirmPassword,onChange:t=>x(a=>({...a,confirmPassword:t.target.value})),className:"w-full border border-theme rounded-lg px-3 py-2"})]}),e.jsx("button",{type:"submit",className:"bg-accent text-white px-4 py-2 rounded hover:bg-accent-hover",children:"Update Password"})]}),e.jsxs("div",{className:"border-t border-theme pt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium text-theme-primary",children:"Data Management"}),e.jsx("p",{className:"text-sm text-theme-secondary",children:"Export or delete your account data."})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:L,className:"bg-theme-hover text-theme-primary border border-theme px-4 py-2 rounded hover:bg-gray-200 dark:bg-gray-700",children:"Export Data"}),e.jsx("button",{onClick:q,className:"bg-error/10 text-error border border-error/30 px-4 py-2 rounded hover:bg-error/20",children:"Delete Account"})]})]})]}),l==="feedback"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-theme-primary",children:"Submit Feedback"}),e.jsx("p",{className:"text-sm text-theme-secondary",children:"Help us improve by sharing your feedback, reporting bugs, or requesting new features."})]}),w.message&&e.jsx("div",{className:`p-4 rounded-lg ${w.type==="success"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-800":"bg-error/10 text-error border border-error/30"}`,children:w.message}),e.jsxs("form",{onSubmit:O,className:"space-y-4 max-w-lg",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:["Category ",e.jsx("span",{className:"text-error",children:"*"})]}),e.jsxs("select",{value:r.category,onChange:t=>p(a=>({...a,category:t.target.value})),className:"w-full border border-theme rounded-lg px-3 py-2 bg-theme-surface text-theme-primary",required:!0,children:[e.jsx("option",{value:"",children:"Select a category..."}),e.jsx("option",{value:"feature_request",children:"New Feature Request"}),e.jsx("option",{value:"bug",children:"Bug"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:["Description ",e.jsx("span",{className:"text-error",children:"*"})]}),e.jsx("textarea",{value:r.description,onChange:t=>p(a=>({...a,description:t.target.value})),className:"w-full border border-theme rounded-lg px-3 py-2 bg-theme-surface text-theme-primary min-h-[120px] resize-y",placeholder:"Please describe your feedback in detail...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-theme-secondary mb-1",children:["Screenshot ",r.category==="bug"&&e.jsx("span",{className:"text-error",children:"* (required for bugs)"})]}),e.jsx("input",{id:"screenshot-input",type:"file",accept:"image/*",onChange:t=>p(a=>{var c;return{...a,screenshot:((c=t.target.files)==null?void 0:c[0])||null}}),className:"w-full border border-theme rounded-lg px-3 py-2 bg-theme-surface text-theme-primary file:mr-4 file:py-1 file:px-3 file:rounded file:border-0 file:text-sm file:bg-accent file:text-white hover:file:bg-accent-hover"}),r.screenshot&&e.jsxs("p",{className:"mt-1 text-sm text-theme-tertiary",children:["Selected: ",r.screenshot.name]})]}),e.jsx("button",{type:"submit",disabled:_,className:"bg-accent text-white px-6 py-2 rounded hover:bg-accent-hover disabled:opacity-50 disabled:cursor-not-allowed",children:_?"Submitting...":"Submit Feedback"})]})]})]})]})]})}export{Y as default};
//# sourceMappingURL=Account-47cfb146.js.map
