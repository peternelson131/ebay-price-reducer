import{c as V,s as P,j as e,X as K,S as Ne,u as G}from"./index-0231291c.js";import{r as s,h as we}from"./vendor-react-4c62d1cf.js";import{C as ye}from"./chevron-down-7e76eefa.js";import{P as Q}from"./plus-1047e1dd.js";import{L as X,C as re}from"./loader-43bf0082.js";import{C as be}from"./check-9783a27c.js";import{R as se}from"./refresh-cw-6c475bbf.js";import{C as le}from"./circle-alert-a9c91508.js";import{P as W}from"./package-c13beea5.js";import{E as ae}from"./external-link-a2bb9e65.js";import{S as ge}from"./shopping-bag-d696d14d.js";import{E as ve}from"./eye-06e1df4e.js";import{C as Ce}from"./chevron-right-269a41e8.js";import{Z as Se}from"./zap-8fb19a26.js";import{C as _e}from"./clock-1f92464c.js";import"./vendor-supabase-5edd3635.js";import"./vendor-query-4b12add6.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Te=V("ellipsis-vertical",Ae);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Pe=V("grip-vertical",Fe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],Oe=V("inbox",Ee);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["rect",{x:"3",y:"4",width:"6",height:"6",rx:"1",key:"cif1o7"}]],De=V("list-todo",$e);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}],["path",{d:"M17 14V2",key:"8ymqnk"}]],Be=V("thumbs-down",Ie);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],me=V("thumbs-up",Le);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],te=V("truck",ze),Me=[{name:"Blue",value:"#3B82F6"},{name:"Purple",value:"#8B5CF6"},{name:"Green",value:"#22C55E"},{name:"Orange",value:"#F97316"},{name:"Cyan",value:"#06B6D4"},{name:"Yellow",value:"#EAB308"},{name:"Red",value:"#EF4444"},{name:"Pink",value:"#EC4899"},{name:"Indigo",value:"#6366F1"},{name:"Teal",value:"#14B8A6"},{name:"Gray",value:"#6B7280"}],pe={crm_statuses:{hasColor:!0,hasSortOrder:!0,nameField:"name",defaultColor:"#6B7280"},crm_collaboration_types:{hasColor:!1,hasSortOrder:!1,nameField:"name"},crm_contact_sources:{hasColor:!1,hasSortOrder:!1,nameField:"name"},crm_marketplaces:{hasColor:!1,hasSortOrder:!1,nameField:"name"}},Re=({isOpen:a,onClose:l,onSave:o,endpoint:d,isSaving:m})=>{const[b,p]=s.useState(""),[j,S]=s.useState("#3B82F6"),[v,N]=s.useState(""),h=pe[d]||{},C=async u=>{if(u.preventDefault(),N(""),!b.trim()){N("Name is required");return}try{await o({name:b.trim(),color:h.hasColor?j:void 0}),p(""),S("#3B82F6"),l()}catch(y){N(y.message||"Failed to save option")}},x=()=>{p(""),S("#3B82F6"),N(""),l()};return a?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:x,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-5 mx-4",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Add New Option"}),e.jsx("button",{onClick:x,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:b,onChange:u=>p(u.target.value),placeholder:"Enter name...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]}),h.hasColor&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Color"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Me.map(({name:u,value:y})=>e.jsx("button",{type:"button",onClick:()=>S(y),className:`w-8 h-8 rounded-full border-2 transition-all ${j===y?"border-gray-900 dark:border-white scale-110":"border-transparent hover:scale-105"}`,style:{backgroundColor:y},title:u},y))}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Preview:"}),e.jsx("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium text-white",style:{backgroundColor:j},children:b||"New Status"})]})]}),v&&e.jsx("p",{className:"text-red-500 text-sm",children:v})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:m||!b.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-colors",children:[m?e.jsx(X,{className:"w-4 h-4 animate-spin"}):e.jsx(be,{className:"w-4 h-4"}),"Save"]})]})]})]})}):null};function ee({endpoint:a,table:l,value:o,onChange:d,label:m,placeholder:b="Select...",allowEmpty:p=!0,emptyLabel:j="None",showColor:S,className:v=""}){const N=a||l,[h,C]=s.useState([]),[x,u]=s.useState(!0),[y,I]=s.useState(!1),[O,U]=s.useState(!1),[B,E]=s.useState(!1),$=pe[N]||{},q=S!==void 0?S:$.hasColor,F=s.useCallback(async()=>{var f;try{u(!0);const{data:T}=await P.auth.getUser(),D=(f=T==null?void 0:T.user)==null?void 0:f.id;let _=P.from(N).select("*");$.hasSortOrder?_=_.order("sort_order",{ascending:!0}):_=_.order("name",{ascending:!0});const{data:r,error:i}=await _;if(i)throw i;const c=(r||[]).filter(k=>k.user_id===null||k.user_id===D);C(c)}catch(T){console.error(`Error fetching ${N} options:`,T)}finally{u(!1)}},[N,$.hasSortOrder]);s.useEffect(()=>{F()},[F]);const H=async({name:f,color:T})=>{var D;U(!0);try{const{data:_}=await P.auth.getUser(),r=(D=_==null?void 0:_.user)==null?void 0:D.id;if(!r)throw new Error("Not authenticated");const i={name:f,user_id:r};if($.hasColor&&T&&(i.color=T),$.hasSortOrder){const A=h.reduce((L,M)=>Math.max(L,M.sort_order||0),0);i.sort_order=A+1}const{data:c,error:k}=await P.from(N).insert(i).select().single();if(k)throw k;return await F(),c!=null&&c.id&&d(c.id),c}finally{U(!1)}},w=h.find(f=>f.id===o),z=(w==null?void 0:w.name)||b;return e.jsxs("div",{className:`relative ${v}`,children:[m&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>E(!B),disabled:x,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-left flex items-center justify-between focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50",children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[q&&(w==null?void 0:w.color)&&e.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:w.color}}),e.jsx("span",{className:w?"":"text-gray-400",children:x?"Loading...":z})]}),e.jsx(ye,{className:`w-4 h-4 text-gray-400 transition-transform ${B?"rotate-180":""}`})]}),B&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>E(!1)}),e.jsxs("div",{className:"absolute z-20 mt-1 w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:[p&&e.jsx("button",{type:"button",onClick:()=>{d(""),E(!1)},className:`w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 ${o?"":"bg-blue-50 dark:bg-blue-900/20"}`,children:e.jsx("span",{className:"text-gray-400",children:j})}),h.map(f=>e.jsxs("button",{type:"button",onClick:()=>{d(f.id),E(!1)},className:`w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2 ${o===f.id?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[q&&f.color&&e.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:f.color}}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:f.name}),f.user_id&&e.jsx("span",{className:"ml-auto text-xs text-gray-400",children:"Custom"})]},f.id)),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600 my-1"}),e.jsxs("button",{type:"button",onClick:()=>{E(!1),I(!0)},className:"w-full px-3 py-2 text-left text-sm text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add New Option"]})]})]})]}),e.jsx(Re,{isOpen:y,onClose:()=>I(!1),onSave:H,endpoint:N,isSaving:O})]})}const he={Sourcing:{color:"#3B82F6",bgClass:"bg-blue-100 dark:bg-blue-900/30",textClass:"text-blue-700 dark:text-blue-300"},Review:{color:"#8B5CF6",bgClass:"bg-purple-100 dark:bg-purple-900/30",textClass:"text-purple-700 dark:text-purple-300"},Negotiating:{color:"#F97316",bgClass:"bg-orange-100 dark:bg-orange-900/30",textClass:"text-orange-700 dark:text-orange-300"},Committed:{color:"#06B6D4",bgClass:"bg-cyan-100 dark:bg-cyan-900/30",textClass:"text-cyan-700 dark:text-cyan-300"},Ordered:{color:"#6366F1",bgClass:"bg-indigo-100 dark:bg-indigo-900/30",textClass:"text-indigo-700 dark:text-indigo-300"},Shipped:{color:"#EAB308",bgClass:"bg-yellow-100 dark:bg-yellow-900/30",textClass:"text-yellow-700 dark:text-yellow-300"},"In Transit":{color:"#FBBF24",bgClass:"bg-amber-100 dark:bg-amber-900/30",textClass:"text-amber-700 dark:text-amber-300"},Delivered:{color:"#10B981",bgClass:"bg-emerald-100 dark:bg-emerald-900/30",textClass:"text-emerald-700 dark:text-emerald-300"},"To Receive":{color:"#F97316",bgClass:"bg-orange-100 dark:bg-orange-900/30",textClass:"text-orange-700 dark:text-orange-300"},Completed:{color:"#22C55E",bgClass:"bg-green-100 dark:bg-green-900/30",textClass:"text-green-700 dark:text-green-300"},Returned:{color:"#EF4444",bgClass:"bg-red-100 dark:bg-red-900/30",textClass:"text-red-700 dark:text-red-300"},Cancelled:{color:"#9CA3AF",bgClass:"bg-gray-100 dark:bg-gray-700/30",textClass:"text-gray-700 dark:text-gray-300"},Problem:{color:"#DC2626",bgClass:"bg-red-100 dark:bg-red-900/30",textClass:"text-red-700 dark:text-red-300"}},ue={pending:{icon:_e,label:"Pending",color:"text-gray-500"},label_created:{icon:W,label:"Label Created",color:"text-blue-500"},picked_up:{icon:te,label:"Picked Up",color:"text-blue-500"},in_transit:{icon:te,label:"In Transit",color:"text-yellow-500"},out_for_delivery:{icon:te,label:"Out for Delivery",color:"text-orange-500"},delivered:{icon:re,label:"Delivered",color:"text-green-500"},exception:{icon:le,label:"Exception",color:"text-red-500"},returned:{icon:W,label:"Returned",color:"text-red-500"}},Xe=({status:a})=>{const l=he[a]||he.Sourcing;return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.bgClass} ${l.textClass}`,children:a})},fe=({status:a})=>{const l=ue[a]||ue.pending,o=l.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 text-xs ${l.color}`,children:[e.jsx(o,{className:"w-3 h-3"}),l.label]})},Ue=({owners:a,max:l=3})=>{if(!a||a.length===0)return e.jsx("span",{className:"text-gray-400 text-sm",children:"No owner"});const o=a.slice(0,l),d=a.length-l;return e.jsxs("div",{className:"flex items-center -space-x-2",children:[o.map((m,b)=>e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs font-medium border-2 border-white dark:border-gray-800",title:m.name||m.email,children:(m.name||m.email||"?")[0].toUpperCase()},m.id||b)),d>0&&e.jsxs("div",{className:"w-7 h-7 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-gray-600 dark:text-gray-300 text-xs font-medium border-2 border-white dark:border-gray-800",children:["+",d]})]})},qe=({product:a,isSelected:l,onSelect:o,onEdit:d})=>{var b;const m=`https://amazon.com/dp/${a.asin}`;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50 cursor-pointer transition-colors ${l?"bg-blue-50 dark:bg-blue-900/20":""}`,onClick:()=>o(a),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700 flex items-center justify-center",children:a.image_url?e.jsx("img",{src:a.image_url,alt:a.asin,className:"w-full h-full object-cover"}):e.jsx(W,{className:"w-6 h-6 text-gray-400"})})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm",children:a.asin}),e.jsx("a",{href:m,target:"_blank",rel:"noopener noreferrer",onClick:p=>p.stopPropagation(),className:"text-gray-400 hover:text-blue-500",children:e.jsx(ae,{className:"w-3.5 h-3.5"})})]}),a.title&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate max-w-xs mt-0.5",children:a.title})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(Xe,{status:((b=a.status)==null?void 0:b.name)||"Sourcing"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(Ue,{owners:a.owners})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`text-sm ${a.decision==="sell"?"text-green-600":a.decision==="keep"?"text-blue-600":"text-gray-400"}`,children:a.decision?a.decision.charAt(0).toUpperCase()+a.decision.slice(1):"-"})}),e.jsx("td",{className:"py-3 px-4",children:a.tracking_number?e.jsx(fe,{status:a.shipping_status}):e.jsx("span",{className:"text-gray-400 text-sm",children:"-"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("button",{onClick:p=>{p.stopPropagation(),d(a)},className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(Te,{className:"w-4 h-4"})})})]})},He=({isOpen:a,onClose:l,onAdd:o,statuses:d})=>{const[m,b]=s.useState(""),[p,j]=s.useState(""),[S,v]=s.useState(!1),[N,h]=s.useState("");s.useEffect(()=>{if(d!=null&&d.length&&!p){const x=d.find(u=>u.name==="Initial Contact")||d[0];x&&j(x.id)}},[d,p]);const C=async x=>{x.preventDefault(),h("");const u=m.trim().toUpperCase();if(!/^B[0-9A-Z]{9}$/.test(u)){h("Invalid ASIN format. Should be like B0XXXXXXXXX");return}v(!0);try{await o({asin:u,status_id:p}),b(""),l()}catch(y){h(y.message||"Failed to add product")}finally{v(!1)}};return a?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:l,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md p-6",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Add Product"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ASIN"}),e.jsx("input",{type:"text",value:m,onChange:x=>b(x.target.value),placeholder:"B0XXXXXXXXX",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Initial Status"}),e.jsx("select",{value:p,onChange:x=>j(x.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:d==null?void 0:d.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))})]}),N&&e.jsx("p",{className:"text-red-500 text-sm",children:N})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:S,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[S?e.jsx(se,{className:"w-4 h-4 animate-spin"}):e.jsx(Q,{className:"w-4 h-4"}),"Add Product"]})]})]})]})}):null},Ve=({isOpen:a,onClose:l,onConfirm:o,isSubmitting:d})=>{const[m,b]=s.useState("");return a?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:l,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-sm p-5 mx-4",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Decline Task"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Optionally provide a reason for declining this task."}),e.jsx("textarea",{value:m,onChange:p=>b(p.target.value),placeholder:"Reason (optional)...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:()=>o(m),disabled:d,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 flex items-center gap-2",children:[d?e.jsx(X,{className:"w-4 h-4 animate-spin"}):e.jsx(K,{className:"w-4 h-4"}),"Decline"]})]})]})}):null},Ge=({product:a,onClose:l,onUpdate:o,statuses:d,collaborationTypes:m,contactSources:b,marketplaces:p})=>{var ne,ie,ce,oe;const[j,S]=s.useState([]),[v,N]=s.useState(!1),[h,C]=s.useState({}),[x,u]=s.useState(!1),[y,I]=s.useState(null),[O,U]=s.useState(null),[B,E]=s.useState(!1),[$,q]=s.useState(!1),[F,H]=s.useState(null),[w,z]=s.useState({}),[f,T]=s.useState({}),[D,_]=s.useState(()=>{const t=localStorage.getItem("crm-panel-width");return t?parseInt(t,10):672}),[r,i]=s.useState(!1),c=s.useRef(null);s.useEffect(()=>{if(!r)return;const t=g=>{const R=window.innerWidth-g.clientX,Z=Math.min(800,Math.max(400,R));_(Z)},n=()=>{i(!1),localStorage.setItem("crm-panel-width",D.toString())};return document.addEventListener("mousemove",t),document.addEventListener("mouseup",n),()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)}},[r,D]),s.useEffect(()=>{const t=n=>{n.key==="Escape"&&a&&l()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[a,l]);const k=s.useCallback(async()=>{if(a!=null&&a.asin){N(!0);try{const t=await G.getAuthToken(),g=await(await fetch(`/.netlify/functions/influencer-tasks?asin=${a.asin}`,{headers:{Authorization:`Bearer ${t}`}})).json();if(g.success){const R=(g.tasks||[]).filter(Z=>Z.status==="pending");S(R)}}catch(t){console.error("Failed to load tasks:",t)}finally{N(!1)}}},[a==null?void 0:a.asin]);s.useEffect(()=>{a!=null&&a.asin?(k(),H(null),z({}),E(!1)):S([])},[a==null?void 0:a.asin,k]);const A=(t,n="success")=>{U({message:t,type:n}),setTimeout(()=>U(null),3e3)},L=async()=>{var t;if(a!=null&&a.asin){q(!0),E(!0);try{const n=await G.getAuthToken(),R=await(await fetch("/.netlify/functions/trigger-asin-correlation-v2",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({asin:a.asin,action:"check"})})).json();if(R.exists&&((t=R.correlations)==null?void 0:t.length)>0){H(R);const J=await(await fetch(`/.netlify/functions/correlation-feedback?action=get&search_asin=${a.asin}`,{headers:{Authorization:`Bearer ${n}`}})).json();if(J.success&&J.feedback){const de={};J.feedback.forEach(xe=>{de[xe.similar_asin]={decision:xe.decision}}),z(de)}}else H({asin:a.asin,correlations:[],notFound:!0})}catch(n){console.error("ACF correlation error:",n),A("Failed to fetch correlations","error")}finally{q(!1)}}},M=async(t,n)=>{if(a!=null&&a.asin){T(g=>({...g,[t]:!0}));try{const g=await G.getAuthToken();(await(await fetch("/.netlify/functions/correlation-feedback",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({action:"save",search_asin:a.asin,candidate_asin:t,decision:n})})).json()).success&&(z(J=>({...J,[t]:{decision:n}})),A(n==="accepted"?"Correlation accepted!":"Correlation declined"))}catch(g){console.error("Failed to save ACF feedback:",g),A("Failed to save feedback","error")}finally{T(g=>({...g,[t]:!1}))}}},Y=async t=>{C(n=>({...n,[t]:"accepting"}));try{const n=await G.getAuthToken();await fetch("/.netlify/functions/influencer-tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({taskId:t,action:"complete"})}),A("Task completed successfully!"),k()}catch(n){console.error("Failed to accept task:",n),A("Failed to complete task","error")}finally{C(n=>({...n,[t]:null}))}},ke=async t=>{if(!y)return;const n=y.id;C(g=>({...g,[n]:"declining"}));try{const g=await G.getAuthToken();await fetch("/.netlify/functions/influencer-tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({taskId:n,action:"dismiss",reason:t})}),A("Task declined"),u(!1),I(null),k()}catch(g){console.error("Failed to decline task:",g),A("Failed to decline task","error")}finally{C(g=>({...g,[n]:null}))}};if(!a)return null;const je=`https://amazon.com/dp/${a.asin}`;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 z-30",onClick:l}),e.jsxs("div",{ref:c,style:{width:`${D}px`},className:"fixed inset-y-0 right-0 bg-white dark:bg-gray-800 shadow-xl border-l border-gray-200 dark:border-gray-700 overflow-y-auto z-40",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 cursor-ew-resize bg-transparent hover:bg-blue-500/30 transition-colors z-50",onMouseDown:t=>{t.preventDefault(),i(!0)},children:e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1.5 h-12 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:e.jsx(Pe,{className:"w-3 h-3 text-gray-400"})})}),e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Product Details"}),e.jsx("button",{onClick:l,className:"w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Close panel (ESC)",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"w-24 h-24 flex-shrink-0 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",children:a.image_url?e.jsx("img",{src:a.image_url,alt:a.asin,className:"w-full h-full object-contain"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(W,{className:"w-8 h-8 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-mono text-sm font-medium",children:a.asin}),e.jsx("a",{href:je,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700",title:"View on Amazon",children:e.jsx(ae,{className:"w-4 h-4"})})]}),a.title&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:a.title})]})]}),e.jsx(ee,{table:"crm_statuses",value:a.status_id,onChange:t=>o({status_id:t}),label:"Status",showColor:!0,placeholder:"Select status..."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Decision"}),e.jsxs("select",{value:a.decision||"",onChange:t=>o({decision:t.target.value||null}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Undecided"}),e.jsx("option",{value:"keep",children:"Keep"}),e.jsx("option",{value:"sell",children:"Sell"})]})]}),a.decision==="sell"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(ee,{table:"crm_marketplaces",value:a.marketplace_id,onChange:t=>o({marketplace_id:t}),label:"Marketplace",placeholder:"Select marketplace..."}),((ne=a.marketplace)==null?void 0:ne.name)==="eBay"&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 space-y-3 border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"Quick List to eBay"})]}),e.jsx("p",{className:"text-xs text-green-700 dark:text-green-300",children:"Create an eBay listing for this product with one click."}),e.jsxs("a",{href:`/auto-list?asin=${a.asin}`,target:"_blank",rel:"noopener noreferrer",className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Open Quick List"]})]})]}),((ie=a.status)==null?void 0:ie.name)==="Delivered"&&!a.decision&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"ðŸ“¬ Product Delivered - Take Action"}),e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-4 space-y-3",children:[e.jsx("p",{className:"text-sm text-emerald-800 dark:text-emerald-200",children:"This product has been delivered! What would you like to do with it?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>o({decision:"sell"}),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Sell It"]}),e.jsxs("button",{onClick:()=>o({decision:"keep"}),className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center justify-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Keep It"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Owners"}),e.jsxs("button",{className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[e.jsx(Q,{className:"w-3.5 h-3.5"})," Add"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(ce=a.owners)==null?void 0:ce.map((t,n)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs",children:(t.name||t.email||"?")[0].toUpperCase()}),t.name||t.email,t.is_primary&&e.jsx("span",{className:"text-xs text-blue-600",children:"(Primary)"})]},t.id||n)),(!a.owners||a.owners.length===0)&&e.jsx("span",{className:"text-gray-400 text-sm",children:"No owners assigned"})]})]}),e.jsx(ee,{table:"crm_collaboration_types",value:a.collaboration_type_id,onChange:t=>o({collaboration_type_id:t}),label:"Collaboration Type",placeholder:"Select type..."}),e.jsx(ee,{table:"crm_contact_sources",value:a.contact_source_id,onChange:t=>o({contact_source_id:t}),label:"Contact Source",placeholder:"Select source..."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Requirements"}),e.jsx("textarea",{value:a.requirements||"",onChange:t=>o({requirements:t.target.value}),placeholder:"Enter brand requirements, notes...",rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none"})]}),a.tracking_number&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Shipping"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Tracking"}),e.jsx("span",{className:"font-mono text-sm",children:a.tracking_number})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Carrier"}),e.jsx("span",{className:"text-sm uppercase",children:a.carrier||"Auto-detect"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Status"}),e.jsx(fe,{status:a.shipping_status})]}),a.shipping_eta&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"ETA"}),e.jsx("span",{className:"text-sm",children:new Date(a.shipping_eta).toLocaleDateString()})]})]})]}),!a.tracking_number&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Shipping"}),e.jsxs("button",{className:"w-full px-4 py-2 border border-dashed border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 rounded-lg hover:border-gray-400 hover:text-gray-700 flex items-center justify-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Add Tracking Number"]})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"ASIN Correlation Finder"}),F&&e.jsx("button",{onClick:()=>E(!B),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:B?e.jsx(ye,{className:"w-4 h-4"}):e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:L,disabled:$,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 flex items-center justify-center gap-2",children:$?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 animate-spin"}),"Finding correlations..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4"}),F?"Refresh Correlations":"Find Similar Products"]})}),B&&F&&e.jsxs("div",{className:"mt-3 space-y-2",children:[F.notFound?e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"No correlations found for this ASIN."}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Try syncing from the full ACF page for fresh data."})]}):((oe=F.correlations)==null?void 0:oe.length)>0?e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg divide-y divide-gray-200 dark:divide-gray-600 max-h-64 overflow-y-auto",children:F.correlations.map((t,n)=>{var g;return e.jsxs("div",{className:"p-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 flex-shrink-0 rounded overflow-hidden bg-gray-100 dark:bg-gray-600",children:t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:"",className:"w-full h-full object-contain"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(W,{className:"w-4 h-4 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-mono text-gray-600 dark:text-gray-400",children:t.asin}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.title||"No title"}),t.suggestedType&&e.jsx("span",{className:`inline-block mt-0.5 text-xs px-1.5 py-0.5 rounded ${t.suggestedType==="variation"?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300"}`,children:t.suggestedType})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[(g=w[t.asin])!=null&&g.decision?e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${w[t.asin].decision==="accepted"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:w[t.asin].decision==="accepted"?"âœ“":"âœ—"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M(t.asin,"accepted"),disabled:f[t.asin],className:"p-1.5 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded hover:bg-green-200 dark:hover:bg-green-900/50 disabled:opacity-50",title:"Accept",children:f[t.asin]?e.jsx(X,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(me,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>M(t.asin,"declined"),disabled:f[t.asin],className:"p-1.5 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded hover:bg-red-200 dark:hover:bg-red-900/50 disabled:opacity-50",title:"Decline",children:f[t.asin]?e.jsx(X,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Be,{className:"w-3.5 h-3.5"})})]}),e.jsx("a",{href:`https://amazon.com/dp/${t.asin}`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 text-gray-400 hover:text-blue-500",title:"View on Amazon",children:e.jsx(ae,{className:"w-3.5 h-3.5"})})]})]},t.asin||n)})}):e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No correlations found."})}),e.jsxs("a",{href:`/asin-lookup?asin=${a.asin}`,className:"text-xs text-purple-600 hover:text-purple-700 flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"}),"Open full ACF page"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),"Pending Tasks",j.length>0&&e.jsx("span",{className:"px-1.5 py-0.5 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 text-xs font-medium rounded-full",children:j.length})]}),e.jsx("button",{onClick:k,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Refresh tasks",children:e.jsx(se,{className:`w-4 h-4 ${v?"animate-spin":""}`})})]}),v&&j.length===0?e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 text-center",children:[e.jsx(X,{className:"w-5 h-5 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Loading tasks..."})]}):j.length===0?e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 text-center",children:[e.jsx(re,{className:"w-6 h-6 mx-auto text-green-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No pending tasks"})]}):e.jsx("div",{className:"space-y-2",children:j.map(t=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:t.marketplace==="US"?"ðŸ‡ºðŸ‡¸":t.marketplace==="CA"?"ðŸ‡¨ðŸ‡¦":t.marketplace==="UK"?"ðŸ‡¬ðŸ‡§":t.marketplace==="DE"?"ðŸ‡©ðŸ‡ª":"ðŸŒ"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t.marketplace||"Upload"," Task"]})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:t.product_title||t.asin})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>Y(t.id),disabled:!!h[t.id],className:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 disabled:opacity-50 transition-colors",title:"Accept task",children:h[t.id]==="accepting"?e.jsx(X,{className:"w-4 h-4 animate-spin"}):e.jsx(be,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{I(t),u(!0)},disabled:!!h[t.id],className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 disabled:opacity-50 transition-colors",title:"Decline task",children:h[t.id]==="declining"?e.jsx(X,{className:"w-4 h-4 animate-spin"}):e.jsx(K,{className:"w-4 h-4"})})]})]},t.id))})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:l,className:"w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors font-medium",children:"Done"})})]}),e.jsx(Ve,{isOpen:x,onClose:()=>{u(!1),I(null)},onConfirm:ke,isSubmitting:y?!!h[y.id]:!1}),O&&e.jsxs("div",{className:`fixed bottom-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 ${O.type==="error"?"bg-red-600 text-white":"bg-green-600 text-white"}`,children:[O.type==="error"?e.jsx(le,{className:"w-4 h-4"}):e.jsx(re,{className:"w-4 h-4"}),O.message]})]})]})};function xa(){const[a]=we(),[l,o]=s.useState([]),[d,m]=s.useState(!0),[b,p]=s.useState(null),[j,S]=s.useState(""),[v,N]=s.useState(""),[h,C]=s.useState(null),[x,u]=s.useState(!1),[y,I]=s.useState(a.get("view")==="delivered"?"delivered":"all"),[O,U]=s.useState([]),[B,E]=s.useState([]),[$,q]=s.useState([]),[F,H]=s.useState([]),w=s.useCallback(async()=>{try{m(!0);let r=P.from("sourced_products").select(`
          *,
          status:crm_statuses(id, name, color),
          collaboration_type:crm_collaboration_types(id, name),
          contact_source:crm_contact_sources(id, name),
          marketplace:crm_marketplaces(id, name, has_quick_list),
          owners:product_owners(owner_id, is_primary)
        `).order("created_at",{ascending:!1});j&&(r=r.ilike("asin",`%${j}%`)),v&&(r=r.eq("status_id",v));const{data:i,error:c}=await r;if(c)throw c;const k=i==null?void 0:i.map(A=>{var L;return{...A,owners:((L=A.owners)==null?void 0:L.map(M=>{var Y;return{id:M.owner_id,is_primary:M.is_primary,name:`User ${((Y=M.owner_id)==null?void 0:Y.slice(0,8))||"?"}`,email:null}}))||[]}});o(k||[])}catch(r){console.error("Error fetching products:",r),p(r.message)}finally{m(!1)}},[j,v]),z=s.useCallback(async()=>{try{const[r,i,c,k]=await Promise.all([P.from("crm_statuses").select("*").order("sort_order"),P.from("crm_collaboration_types").select("*").order("name"),P.from("crm_contact_sources").select("*").order("name"),P.from("crm_marketplaces").select("*").order("name")]);U(r.data||[]),E(i.data||[]),q(c.data||[]),H(k.data||[])}catch(r){console.error("Error fetching lookups:",r)}},[]);s.useEffect(()=>{w(),z()},[w,z]);const f=async r=>{try{const i=await G.getAuthToken(),c=await fetch(`/.netlify/functions/keepa-lookup?asin=${r}`,{headers:{Authorization:`Bearer ${i}`}}),k=c.headers.get("content-type");return!c.ok||!(k!=null&&k.includes("application/json"))?(console.log("Keepa function unavailable, using direct image URL"),null):await c.json()}catch(i){return console.log("Keepa fetch failed, using direct image URL:",i.message),null}},T=async r=>{const{data:i}=await P.auth.getUser(),c=await f(r.asin),k={...r,user_id:i.user.id,image_url:(c==null?void 0:c.imageUrl)||`https://images.keepa.com/600/${r.asin}.jpg`,title:(c==null?void 0:c.title)||null},{data:A,error:L}=await P.from("sourced_products").insert(k).select().single();if(L)throw L;w()},D=async r=>{if(!h)return;const{error:i}=await P.from("sourced_products").update(r).eq("id",h.id);if(i){console.error("Error updating product:",i);return}C(c=>({...c,...r})),w()},_=l.filter(r=>{var i;return y==="delivered"?((i=r.status)==null?void 0:i.name)==="Delivered":!0});return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:y==="delivered"?"Delivered Items":"Product CRM"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:y==="delivered"?"Products ready for listing - review and create eBay listings":"Track your sourced products from discovery to listing"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Add Product"]})]})})}),e.jsx("div",{className:"px-4 sm:px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>I("all"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${y==="all"?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900"}`,children:"All Products"}),e.jsxs("button",{onClick:()=>I("delivered"),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors flex items-center gap-1.5 ${y==="delivered"?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-900"}`,children:[e.jsx(Oe,{className:"w-4 h-4"}),"Delivered"]})]}),e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:j,onChange:r=>S(r.target.value),placeholder:"Search by ASIN...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"})]}),e.jsxs("select",{value:v,onChange:r=>N(r.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",disabled:y==="delivered",children:[e.jsx("option",{value:"",children:"All Statuses"}),O.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx("button",{onClick:w,className:"p-2 text-gray-400 hover:text-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg",children:e.jsx(se,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"px-4 sm:px-6 pb-8",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:d?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(se,{className:"w-8 h-8 text-gray-400 animate-spin mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Loading products..."})]}):b?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(le,{className:"w-8 h-8 text-red-400 mx-auto"}),e.jsx("p",{className:"text-red-500 mt-2",children:b}),e.jsx("button",{onClick:w,className:"mt-4 text-blue-600 hover:text-blue-700",children:"Try again"})]}):_.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(W,{className:"w-12 h-12 text-gray-300 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"No products found"}),e.jsxs("button",{onClick:()=>u(!0),className:"mt-4 text-blue-600 hover:text-blue-700 flex items-center gap-1 mx-auto",children:[e.jsx(Q,{className:"w-4 h-4"})," Add your first product"]})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider py-3 px-4",children:"Image"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider py-3 px-4",children:"ASIN"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider py-3 px-4",children:"Status"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider py-3 px-4",children:"Owners"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider py-3 px-4",children:"Decision"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider py-3 px-4",children:"Shipping"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider py-3 px-4 w-12"})]})}),e.jsx("tbody",{children:_.map(r=>e.jsx(qe,{product:r,isSelected:(h==null?void 0:h.id)===r.id,onSelect:C,onEdit:C},r.id))})]})})}),e.jsx(He,{isOpen:x,onClose:()=>u(!1),onAdd:T,statuses:O}),e.jsx(Ge,{product:h,onClose:()=>C(null),onUpdate:D,statuses:O,collaborationTypes:B,contactSources:$,marketplaces:F})]})}export{xa as default};
//# sourceMappingURL=ProductCRM-8d13df7c.js.map
