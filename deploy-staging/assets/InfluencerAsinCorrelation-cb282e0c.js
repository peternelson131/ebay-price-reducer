import{j as e,u as L}from"./index-0231291c.js";import{r as i}from"./vendor-react-4c62d1cf.js";import{a as S,h as I}from"./api-0ba7f9da.js";import"./vendor-supabase-5edd3635.js";import"./vendor-query-4b12add6.js";function ie(){const[T,V]=i.useState(""),[b,M]=i.useState(!1),[g,h]=i.useState(!1),[K,o]=i.useState(""),[l,C]=i.useState(null),[A,d]=i.useState(null),[P,_]=i.useState(!1),[v,F]=i.useState(null),j=i.useRef(null),z=i.useRef(0),[y,N]=i.useState({}),[O,B]=i.useState(!1),[f,k]=i.useState({});i.useState({});const[q,R]=i.useState({}),[w,U]=i.useState(!0),$=s=>{const a=y[s];if(!a||a.decision!=="accepted")return!1;const c=[{available:a.available_us,uploaded:a.uploaded_usa},{available:a.available_ca,uploaded:a.uploaded_ca},{available:a.available_de,uploaded:a.uploaded_de},{available:a.available_uk,uploaded:a.uploaded_uk}].filter(t=>t.available===!0);return c.length===0?!1:c.every(t=>t.uploaded===!0)},E=async(s,a)=>{if(l!=null&&l.asin){k(n=>({...n,[s]:!0})),a==="accepted"&&R(n=>({...n,[s]:!0}));try{const n=await L.getAuthToken(),t=await(await fetch("/.netlify/functions/correlation-feedback",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({action:"save",search_asin:l.asin,candidate_asin:s,decision:a})})).json();if(t.success){const r={decision:a};t.availability&&(r.available_us=t.availability.US,r.available_ca=t.availability.CA,r.available_de=t.availability.DE,r.available_uk=t.availability.UK),N(m=>({...m,[s]:{...m[s],...r}}))}else throw new Error(t.error||"Failed to save")}catch(n){console.error("Failed to save feedback:",n),alert("Failed to save feedback. Please try again.")}finally{k(n=>({...n,[s]:!1})),R(n=>({...n,[s]:!1}))}}},W=async s=>{B(!0);try{const a=await L.getAuthToken(),c=await(await fetch(`/.netlify/functions/correlation-feedback?action=get&search_asin=${s}`,{headers:{Authorization:`Bearer ${a}`}})).json();if(c.success&&c.feedback){const t={};c.feedback.forEach(r=>{t[r.similar_asin]={decision:r.decision,uploaded_usa:r.uploaded_usa,uploaded_ca:r.uploaded_ca,uploaded_de:r.uploaded_de,uploaded_uk:r.uploaded_uk,available_us:r.available_us,available_ca:r.available_ca,available_de:r.available_de,available_uk:r.available_uk}}),N(t)}}catch(a){console.error("Failed to load feedback:",a)}finally{B(!1)}},J=s=>{E(s.asin,"accepted")},Y=s=>{E(s.asin,"declined")},G=async s=>{if(l!=null&&l.asin){k(a=>({...a,[s.asin]:!0}));try{const a=await L.getAuthToken(),c=await(await fetch("/.netlify/functions/correlation-feedback",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({action:"undo",search_asin:l.asin,candidate_asin:s.asin})})).json();if(c.success)N(t=>{const r={...t};return delete r[s.asin],r});else throw new Error(c.error||"Failed to undo")}catch(a){console.error("Failed to undo:",a),alert("Failed to undo. Please try again.")}finally{k(a=>({...a,[s.asin]:!1}))}}},Z=async s=>{s.preventDefault();const a=T.trim().toUpperCase();if(!a){d("Please enter an ASIN");return}if(!/^B[0-9A-Z]{9}$/i.test(a)){d("Invalid ASIN format. Should be B followed by 9 characters (e.g., B08N5WRWNW)");return}M(!0),d(null),C(null),N({});try{const n=await S.checkAsinCorrelation(a);n.exists&&n.correlations&&n.correlations.length>0?(C(n),W(a)):(F(a),_(!0))}catch(n){d(I(n,"Failed to check ASIN"))}finally{M(!1)}},u=i.useCallback(()=>{j.current&&(clearInterval(j.current),j.current=null),z.current=0},[]),D=i.useCallback(s=>{u(),z.current=0;const a=600,n=Date.now();let c=0;j.current=setInterval(async()=>{const t=Math.floor((Date.now()-n)/1e3);z.current=t;const r=Math.floor(t/60),m=t%60,p=r>0?`${r}m ${m}s`:`${m}s`;if(o(`Checking for results... (${p})`),!(t-c<5)){c=t;try{const x=await S.checkAsinCorrelation(s);x.exists&&x.correlations&&x.correlations.length>0?(u(),C(x),W(s),h(!1),o("")):t>=a&&(u(),h(!1),o(""),d("Sync timed out after 10 minutes. The workflow may still be running - try searching again in a few minutes."))}catch(x){console.error("Polling error:",x),t>=a&&(u(),h(!1),o(""),d("Failed to check sync status. Please try again."))}}},1e3)},[u]),Q=async()=>{if(v){_(!1),h(!0),d(null),o("Starting sync...");try{S.syncAsinCorrelation(v).catch(s=>{console.log("Sync request completed or timed out:",(s==null?void 0:s.message)||"ok")}),o("Sync started. Checking for results..."),D(v)}catch(s){d(I(s,"Failed to start sync")),h(!1),o("")}finally{F(null)}}},X=()=>{_(!1),F(null),u()},ee=async()=>{if(l!=null&&l.asin){h(!0),d(null),o("Starting re-sync...");try{S.syncAsinCorrelation(l.asin).catch(s=>{console.log("Re-sync request completed or timed out:",(s==null?void 0:s.message)||"ok")}),o("Re-sync started. Checking for results..."),D(l.asin)}catch(s){d(I(s,"Failed to start re-sync")),h(!1),o("")}}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-theme-primary",children:"ASIN Correlation Finder"}),e.jsx("p",{className:"text-theme-secondary mt-1",children:"Find similar and related Amazon products"})]}),e.jsx("form",{onSubmit:Z,className:"mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:T,onChange:s=>V(s.target.value.toUpperCase()),placeholder:"Enter ASIN (e.g., B08N5WRWNW)",className:"flex-1 px-4 py-2 bg-theme-surface border border-theme rounded-lg text-theme-primary placeholder-text-tertiary focus:outline-none focus:border-accent",disabled:b||g}),e.jsx("button",{type:"submit",disabled:b||g,className:"px-6 py-2 bg-accent text-white rounded-lg hover:bg-accent-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Checking...":"Search"})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-theme-surface rounded-lg border border-theme-xl p-6 max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("svg",{className:"w-6 h-6 text-accent mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-semibold text-theme-primary",children:"ASIN Not Found"})]}),e.jsxs("p",{className:"text-theme-secondary mb-6",children:["The ASIN ",e.jsx("span",{className:"font-mono font-semibold text-accent",children:v})," was not found in our database. Would you like to sync this ASIN?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:X,className:"px-4 py-2 text-theme-secondary border border-theme rounded-lg hover:bg-theme-primary transition-colors",children:"No"}),e.jsx("button",{onClick:Q,className:"px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-hover transition-colors",children:"Yes, Sync ASIN"})]})]})}),A&&e.jsx("div",{className:"bg-error/10 border border-error/30 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-error mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-error",children:A})]})}),g&&e.jsxs("div",{className:"bg-theme-surface rounded-lg border border-theme p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-theme-secondary",children:"Syncing ASIN and finding correlations..."}),e.jsx("p",{className:"mt-2 text-sm text-accent font-medium",children:K}),e.jsx("p",{className:"mt-1 text-xs text-theme-tertiary",children:"The workflow is running in the background. Results will appear automatically."}),e.jsx("button",{onClick:()=>{u(),h(!1),o("")},className:"mt-4 px-4 py-2 text-sm text-theme-secondary border border-theme rounded-lg hover:bg-theme-primary transition-colors",children:"Cancel"})]}),l&&!b&&!g&&(()=>{var n,c;const s=((n=l.correlations)==null?void 0:n.filter(t=>$(t.asin)).length)||0,a=w?((c=l.correlations)==null?void 0:c.filter(t=>!$(t.asin)))||[]:l.correlations||[];return e.jsxs("div",{className:"bg-theme-surface rounded-lg border border-theme",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-theme flex flex-wrap justify-between items-center gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Results for ASIN: ",e.jsx("span",{className:"text-accent",children:l.asin})]}),e.jsx("div",{className:"flex items-center gap-3 mt-1",children:l.correlations&&Array.isArray(l.correlations)&&e.jsxs("span",{className:"text-sm text-theme-tertiary",children:[a.length," result",a.length!==1?"s":""," shown",s>0&&w&&e.jsxs("span",{className:"text-theme-tertiary",children:[" Â· ",s," completed hidden"]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s>0&&e.jsxs("label",{className:"flex items-center gap-2 text-sm text-theme-secondary cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:t=>U(t.target.checked),className:"w-4 h-4 rounded border-theme bg-theme-surface text-accent focus:ring-accent focus:ring-offset-0"}),"Hide completed"]}),e.jsxs("button",{onClick:ee,disabled:g,className:"px-4 py-2 text-sm bg-theme-hover text-theme-secondary border border-theme rounded-lg hover:bg-gray-200 dark:bg-gray-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Re-sync"]})]})]}),e.jsx("div",{className:"p-6",children:a.length>0?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 py-2 border-b border-theme mb-2 text-xs text-theme-tertiary font-medium",children:[e.jsx("div",{className:"w-16 flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:"Product"}),e.jsx("div",{className:"w-24 flex-shrink-0 text-center",children:"ASIN"}),e.jsx("div",{className:"w-40 flex-shrink-0 text-center",children:"Actions"}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("img",{src:"https://hatscripts.github.io/circle-flags/flags/us.svg",alt:"US",className:"w-6 h-6",title:"United States"}),e.jsx("img",{src:"https://hatscripts.github.io/circle-flags/flags/ca.svg",alt:"CA",className:"w-6 h-6",title:"Canada"}),e.jsx("img",{src:"https://hatscripts.github.io/circle-flags/flags/de.svg",alt:"DE",className:"w-6 h-6",title:"Germany"}),e.jsx("img",{src:"https://hatscripts.github.io/circle-flags/flags/gb.svg",alt:"UK",className:"w-6 h-6",title:"United Kingdom"})]})]}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700/50",children:[...a].sort((t,r)=>t.suggestedType==="variation"&&r.suggestedType!=="variation"?-1:t.suggestedType!=="variation"&&r.suggestedType==="variation"?1:0).map((t,r)=>{var H;const m=t.imageUrl||null,p=y[t.asin]||{},x=q[t.asin];return e.jsxs("div",{className:"flex items-center gap-4 py-3 hover:bg-theme-primary transition-colors",children:[e.jsx("div",{className:"flex-shrink-0 w-16 h-16",children:m?e.jsx("img",{src:m,alt:t.title||"Product",className:"w-16 h-16 object-contain bg-theme-primary rounded",onError:te=>{te.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ccc"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>'}}):e.jsx("div",{className:"w-16 h-16 bg-theme-hover rounded flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-theme-tertiary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-theme-primary truncate",children:t.title||"Untitled Product"}),t.suggestedType&&e.jsx("span",{className:`inline-block mt-1 text-xs px-2 py-0.5 rounded ${t.suggestedType==="variation"?"bg-purple-100 text-purple-800":"bg-success/10 text-success"}`,children:t.suggestedType})]}),e.jsxs("div",{className:"flex-shrink-0 w-24 text-center",children:[e.jsx("p",{className:"text-sm font-mono text-theme-secondary",children:t.asin||"N/A"}),t.url&&e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-accent hover:underline",children:"View"})]}),e.jsx("div",{className:"flex-shrink-0 w-40 flex items-center justify-center gap-2",children:O?e.jsx("span",{className:"text-xs text-theme-tertiary",children:"Loading..."}):(H=y[t.asin])!=null&&H.decision?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${y[t.asin].decision==="accepted"?"bg-success/20 text-success":"bg-error/20 text-error"}`,children:y[t.asin].decision==="accepted"?"âœ“ Accepted":"âœ— Declined"}),e.jsx("button",{onClick:()=>G(t),disabled:f[t.asin],className:"text-xs px-1 py-1 text-theme-tertiary hover:text-theme-secondary hover:bg-theme-hover rounded transition-colors disabled:opacity-50",title:"Undo decision",children:f[t.asin]?"...":"â†©"})]}):e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>J(t),disabled:f[t.asin],className:"text-xs px-3 py-1.5 bg-success/20 text-success rounded-full hover:bg-success/30 transition-colors disabled:opacity-50",children:f[t.asin]?"...":"âœ“ Accept"}),e.jsx("button",{onClick:()=>Y(t),disabled:f[t.asin],className:"text-xs px-3 py-1.5 bg-error/20 text-error rounded-full hover:bg-error/30 transition-colors disabled:opacity-50",children:f[t.asin]?"...":"âœ— Decline"})]})}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:x?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-8 text-center text-theme-tertiary text-xs",children:"..."}),e.jsx("span",{className:"w-8 text-center text-theme-tertiary text-xs",children:"..."}),e.jsx("span",{className:"w-8 text-center text-theme-tertiary text-xs",children:"..."}),e.jsx("span",{className:"w-8 text-center text-theme-tertiary text-xs",children:"..."})]}):p.decision==="accepted"?e.jsxs(e.Fragment,{children:[p.available_us===!0?e.jsx("a",{href:`https://www.amazon.com/dp/${t.asin}`,target:"_blank",rel:"noopener noreferrer",className:"hover:scale-110 transition-transform",title:"View on Amazon.com",children:e.jsx("img",{src:"https://hatscripts.github.io/circle-flags/flags/us.svg",alt:"US",className:"w-6 h-6"})}):e.jsx("span",{className:"w-6 h-6"}),p.available_ca===!0?e.jsx("a",{href:`https://www.amazon.ca/dp/${t.asin}`,target:"_blank",rel:"noopener noreferrer",className:"hover:scale-110 transition-transform",title:"View on Amazon.ca",children:e.jsx("img",{src:"https://hatscripts.github.io/circle-flags/flags/ca.svg",alt:"CA",className:"w-6 h-6"})}):e.jsx("span",{className:"w-6 h-6"}),p.available_de===!0?e.jsx("a",{href:`https://www.amazon.de/dp/${t.asin}`,target:"_blank",rel:"noopener noreferrer",className:"hover:scale-110 transition-transform",title:"View on Amazon.de",children:e.jsx("img",{src:"https://hatscripts.github.io/circle-flags/flags/de.svg",alt:"DE",className:"w-6 h-6"})}):e.jsx("span",{className:"w-6 h-6"}),p.available_uk===!0?e.jsx("a",{href:`https://www.amazon.co.uk/dp/${t.asin}`,target:"_blank",rel:"noopener noreferrer",className:"hover:scale-110 transition-transform",title:"View on Amazon.co.uk",children:e.jsx("img",{src:"https://hatscripts.github.io/circle-flags/flags/gb.svg",alt:"UK",className:"w-6 h-6"})}):e.jsx("span",{className:"w-6 h-6"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-8 text-center text-theme-tertiary",children:"â€”"}),e.jsx("span",{className:"w-8 text-center text-theme-tertiary",children:"â€”"}),e.jsx("span",{className:"w-8 text-center text-theme-tertiary",children:"â€”"}),e.jsx("span",{className:"w-8 text-center text-theme-tertiary",children:"â€”"})]})})]},t.asin||r)})})]}):e.jsx("div",{className:"text-center py-8 text-theme-tertiary",children:s>0&&w?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-12 h-12 text-success mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-success font-medium",children:"All correlations completed! ðŸŽ‰"}),e.jsxs("p",{className:"text-sm mt-1",children:[s," correlation",s!==1?"s":""," uploaded to all marketplaces."," ",e.jsx("button",{onClick:()=>U(!1),className:"text-accent hover:underline",children:"Show completed"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-12 h-12 text-theme-tertiary mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{children:"No correlations found for this ASIN"}),e.jsx("p",{className:"text-sm mt-1",children:"Try syncing to fetch the latest data"})]})})})]})})(),!l&&!b&&!g&&!A&&!P&&e.jsxs("div",{className:"bg-theme-primary rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-theme-tertiary mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("h3",{className:"text-lg font-medium text-theme-secondary",children:"Enter an ASIN to get started"}),e.jsx("p",{className:"text-theme-tertiary mt-1",children:"Find products similar to any Amazon listing"}),e.jsxs("div",{className:"mt-4 text-sm text-theme-tertiary",children:[e.jsx("p",{children:"Tip: You can find an ASIN on any Amazon product page"}),e.jsx("p",{children:"Look in the product details section or the URL"})]})]})]})}export{ie as default};
//# sourceMappingURL=InfluencerAsinCorrelation-cb282e0c.js.map
