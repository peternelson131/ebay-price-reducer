import{c as Fe,b as Me,j as t,S as Ae,X as Ee,s as D,l as L,u as De}from"./index-0231291c.js";import{u as Ie,r as x}from"./vendor-react-4c62d1cf.js";import"./api-0ba7f9da.js";import{u as Te,b as U,c as I}from"./vendor-query-4b12add6.js";import{R as qe}from"./refresh-cw-6c475bbf.js";import{F as Qe}from"./funnel-9484537d.js";import"./vendor-supabase-5edd3635.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M13 8c0-2.76-2.46-5-5.5-5S2 5.24 2 8h2l1-1 1 1h4",key:"foxbe7"}],["path",{d:"M13 7.14A5.82 5.82 0 0 1 16.5 6c3.04 0 5.5 2.24 5.5 5h-3l-1-1-1 1h-3",key:"18arnh"}],["path",{d:"M5.89 9.71c-2.15 2.15-2.3 5.47-.35 7.43l4.24-4.25.7-.7.71-.71 2.12-2.12c-1.95-1.96-5.27-1.8-7.42.35",key:"ywahnh"}],["path",{d:"M11 15.5c.5 2.5-.17 4.5-1 6.5h4c2-5.5-.5-12-1-14",key:"ft0feo"}]],Be=Fe("tree-palm",Oe),Re=async()=>await Me.getStrategies(),Ue={fixed_percentage:{name:"Fixed Percentage",strategy_type:"percentage",reduction_percentage:10,reduction_amount:0,interval_days:7},market_based:{name:"Market Based",strategy_type:"percentage",reduction_percentage:5,reduction_amount:0,interval_days:14},time_based:{name:"Time Based",strategy_type:"percentage",reduction_percentage:15,reduction_amount:0,interval_days:30}},ce=(n,p=[])=>{if(!n)return null;if(n.strategy_id){const c=p.find(b=>b.id===n.strategy_id);if(c)return c}if(n.reduction_strategy){const c=p.find(d=>d.id===n.reduction_strategy);if(c)return c;const b=Ue[n.reduction_strategy];if(b)return b}return null},P=["image","title","quantity","currentPrice","minimumPrice","priceReductionEnabled","strategy","listingAge","actions"],Ve=()=>{try{const n=localStorage.getItem("listings-column-order");if(n){const p=JSON.parse(n),c=p.filter(b=>P.includes(b));return c.length!==p.length||c.length!==P.length?P:c}}catch(n){console.warn("Failed to load column order from localStorage:",n)}return P},Ke=()=>{try{const n=localStorage.getItem("listings-visible-columns");if(n){const p=JSON.parse(n),c={};let b=!1;for(const d of P)d in p?c[d]=p[d]:c[d]=!0;for(const d in p)if(!P.includes(d)){b=!0;break}return b&&localStorage.setItem("listings-visible-columns",JSON.stringify(c)),c}}catch(n){console.warn("Failed to load visible columns from localStorage:",n)}return{image:!0,title:!0,quantity:!0,currentPrice:!0,minimumPrice:!0,priceReductionEnabled:!0,strategy:!0,listingAge:!0,actions:!0}},We=()=>{try{const n=localStorage.getItem("listings-items-per-page");if(n){const p=parseInt(n,10);if([10,25,50,100].includes(p))return p}}catch(n){console.warn("Failed to load items per page from localStorage:",n)}return 25};function st(){Ie();const[n,p]=x.useState("Active"),[c,b]=x.useState(""),[d,de]=x.useState({key:null,direction:"asc"}),[F,ue]=x.useState(Ke()),[M,me]=x.useState(Ve()),[A,V]=x.useState(null),[y,T]=x.useState([]),[K,W]=x.useState(null),[l,J]=x.useState(1),[S,he]=x.useState(We()),[q,ee]=x.useState(!1),u=Te(),m=(e,r)=>{W({type:e,message:r}),setTimeout(()=>W(null),5e3)},ge=async()=>{ee(!0);try{const{data:{session:e}}=await D.auth.getSession();if(!(e!=null&&e.access_token)){m("error","Please log in to sync listings");return}const r=await fetch("/.netlify/functions/sync-ebay-listings",{method:"POST",headers:{Authorization:`Bearer ${e.access_token}`,"Content-Type":"application/json"}}),s=await r.json();if(!r.ok)throw new Error(s.error||s.message||"Sync failed");if(s.success&&s.summary){const{totalImported:a,totalUpdated:i}=s.summary;m("success",`Synced ${a} listings (${i} updated)`),u.invalidateQueries(["listings"])}else m("success","Sync completed"),u.invalidateQueries(["listings"])}catch(e){console.error("Sync error:",e),m("error",`Sync failed: ${e.message}`)}finally{ee(!1)}};x.useEffect(()=>{try{localStorage.setItem("listings-column-order",JSON.stringify(M))}catch(e){console.warn("Failed to save column order to localStorage:",e)}},[M]),x.useEffect(()=>{try{localStorage.setItem("listings-visible-columns",JSON.stringify(F))}catch(e){console.warn("Failed to save visible columns to localStorage:",e)}},[F]),x.useEffect(()=>{try{localStorage.setItem("listings-items-per-page",S.toString())}catch(e){console.warn("Failed to save items per page to localStorage:",e)}},[S]),x.useEffect(()=>{J(1)},[c,y,n]);const{data:Q,isLoading:xe,error:O,refetch:Je}=U(["listings",{status:n}],()=>L.getListings({status:n}),{keepPreviousData:!0,refetchOnWindowFocus:!1,refetchOnMount:!1,staleTime:6*60*60*1e3,cacheTime:12*60*60*1e3,retry:1,refetchInterval:!1,refetchIntervalInBackground:!1,refetchOnReconnect:"always"}),{data:z,isLoading:ze}=U(["userProfile"],()=>De.getProfile(),{retry:1,refetchOnWindowFocus:!1}),{data:_=[],isLoading:Ge}=U(["strategies","active"],()=>Re(),{retry:1,refetchOnWindowFocus:!1,staleTime:5*60*1e3,cacheTime:30*60*1e3}),{data:B,isLoading:pe}=U(["vacationMode"],async()=>{const{data:{user:e}}=await D.auth.getUser();if(!e)return!1;const{data:r}=await D.from("users").select("vacation_mode").eq("id",e.id).single();return(r==null?void 0:r.vacation_mode)||!1},{retry:1,refetchOnWindowFocus:!1,staleTime:60*1e3}),te=I(async e=>{const{data:{user:r}}=await D.auth.getUser();if(!r)throw new Error("Not logged in");const{error:s}=await D.from("users").update({vacation_mode:e,vacation_mode_since:e?new Date().toISOString():null}).eq("id",r.id);if(s)throw s;return e},{onSuccess:e=>{u.setQueryData(["vacationMode"],e),m("success",e?"ðŸ–ï¸ Vacation mode ON - price reductions paused":"âœ… Vacation mode OFF - price reductions will resume")},onError:e=>{m("error",`Failed to toggle vacation mode: ${e.message}`)}}),G=I(L.endListing,{onSuccess:()=>{m("success","Listing closed successfully"),u.invalidateQueries("listings")},onError:e=>{m("error",e.message||"Failed to close listing")}}),be=I(({listingId:e,minimumPrice:r})=>L.updateListing(e,{minimum_price:r}),{onMutate:async({listingId:e,minimumPrice:r})=>{await u.cancelQueries(["listings",{status:n}]);const s=u.getQueryData(["listings",{status:n}]);return u.setQueryData(["listings",{status:n}],a=>a&&a.map(i=>i.id===e?{...i,minimum_price:r}:i)),{previousListings:s}},onSuccess:()=>{m("success","Minimum price updated")},onError:(e,r,s)=>{s!=null&&s.previousListings&&u.setQueryData(["listings",{status:n}],s.previousListings),m("error",e.message||"Failed to update minimum price")},onSettled:()=>{u.invalidateQueries(["listings",{status:n}])}}),ye=I(({listingId:e,strategyId:r})=>L.updateListing(e,{strategy_id:r||null}),{onMutate:async({listingId:e,strategyId:r})=>{await u.cancelQueries(["listings",{status:n}]);const s=u.getQueryData(["listings",{status:n}]);return u.setQueryData(["listings",{status:n}],a=>a&&a.map(i=>i.id===e?{...i,strategy_id:r}:i)),{previousListings:s}},onSuccess:e=>{var s;const r=e.strategy_id?((s=_.find(a=>a.id===e.strategy_id))==null?void 0:s.name)||"selected strategy":"No strategy";m("success",`Strategy updated to ${r}`)},onError:(e,r,s)=>{s!=null&&s.previousListings&&u.setQueryData(["listings",{status:n}],s.previousListings),m("error",e.message||"Failed to update strategy")},onSettled:()=>{u.invalidateQueries(["listings",{status:n}])}}),Y=I(({listingId:e,enabled:r})=>L.updateListing(e,{enable_auto_reduction:r}),{onMutate:async({listingId:e,enabled:r})=>{await u.cancelQueries(["listings",{status:n}]);const s=u.getQueryData(["listings",{status:n}]);return u.setQueryData(["listings",{status:n}],a=>a&&a.map(i=>i.id===e?{...i,enable_auto_reduction:r}:i)),{previousListings:s}},onSuccess:(e,{enabled:r})=>{m("success",`Price reduction ${r?"enabled":"disabled"}`)},onError:(e,r,s)=>{s!=null&&s.previousListings&&u.setQueryData(["listings",{status:n}],s.previousListings),m("error",e.message||"Failed to update price reduction status")},onSettled:()=>{u.invalidateQueries(["listings",{status:n}])}}),re=e=>{window.confirm("Are you sure you want to close this listing? This will mark it as closed in your local database.")&&G.mutate(e)},fe=async()=>{var k;const e=n==="Ended"?C:C.filter(f=>f.quantity_available===0);if(e.length===0){m("info","No listings to close");return}const r=n==="Ended"?"ended":"sold-out",s=`Close ${e.length} ${r} listing(s)? This will mark them as closed in your local database.`;if(!window.confirm(s))return;W({type:"info",message:`Closing ${e.length} listings...`});let a=0,i=0,o=0;const g=[];for(const f of e)try{const v=await L.endListing(f.id);(k=v==null?void 0:v.message)!=null&&k.toLowerCase().includes("already")?i++:a++}catch(v){console.error(`Failed to close listing ${f.id}:`,v),o++;const $=v.message||"Unknown error";g.push({sku:f.ebay_sku||f.ebay_item_id,error:$})}u.invalidateQueries("listings");const N=a+i;if(o===0)i>0?m("success",`Successfully processed ${N} listing(s) (${a} closed, ${i} already closed on eBay)`):m("success",`Successfully closed ${a} listing(s)`);else{const f=g.slice(0,3).map($=>$.sku).join(", "),v=g.length>3?` and ${g.length-3} more`:"";m("warning",`Closed ${N} listing(s), ${o} failed. Failed: ${f}${v}. Check console for details.`),console.error("Failed listings:",g)}},se=(e,r)=>{const s=parseFloat(r);!isNaN(s)&&s>=0&&be.mutate({listingId:e,minimumPrice:s})},ae=(e,r)=>{ye.mutate({listingId:e,strategyId:r||null})},ne=e=>{if(!e.enable_auto_reduction&&(!e.minimum_price||e.minimum_price<=0)){m("error","Please set a minimum price before enabling price reduction");return}if(!(z!=null&&z.id)){m("error","User not authenticated");return}Y.mutate({listingId:e.id,enabled:!e.enable_auto_reduction})},ve=e=>{let r="asc";d.key===e&&d.direction==="asc"&&(r="desc"),de({key:e,direction:r})},je=e=>{ue(r=>({...r,[e]:!r[e]}))},we=(e,r)=>{V(r),e.dataTransfer.effectAllowed="move"},Ne=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},_e=(e,r)=>{if(e.preventDefault(),A&&A!==r){const s=[...M],a=s.indexOf(A),i=s.indexOf(r);s.splice(a,1),s.splice(i,0,A),me(s)}V(null)},ke=()=>{V(null)},ie=e=>{const r=new Date,s=new Date(e),a=Math.abs(r-s);return`${Math.ceil(a/(1e3*60*60*24))} days`},X=x.useMemo(()=>{let e=Q||[];if(e||(e=[]),c.trim()){const r=c.toLowerCase();e=e.filter(s=>{var o,g,N,k,f,v,$;const a=ce(s,_),i=a?a.name:"";return((o=s.title)==null?void 0:o.toLowerCase().includes(r))||((g=s.ebay_sku)==null?void 0:g.toLowerCase().includes(r))||((N=s.current_price)==null?void 0:N.toString().includes(r))||((k=s.original_price)==null?void 0:k.toString().includes(r))||((f=s.quantity_available)==null?void 0:f.toString().includes(r))||((v=s.minimum_price)==null?void 0:v.toString().includes(r))||i.toLowerCase().includes(r)||(($=s.id)==null?void 0:$.toLowerCase().includes(r))})}return y.length>0&&(e=e.filter(r=>y.every(s=>{var N;if(!s.field||!s.value)return!0;let a;if(s.field==="strategy"){if(s.value==="none")return!r.strategy_id;a=r.strategy_id}else if(s.field==="listing_age"){const k=new Date(r.created_at||new Date);a=Math.ceil((new Date-k)/(1e3*60*60*24))}else s.field==="enable_auto_reduction"?a=(N=r.enable_auto_reduction)==null?void 0:N.toString():a=r[s.field];const i=s.value,o=parseFloat(a),g=parseFloat(i);switch(s.operator){case"equals":return s.field==="sku"?a==null?void 0:a.toLowerCase().includes(i.toLowerCase()):(a==null?void 0:a.toString())===i;case"contains":return a==null?void 0:a.toLowerCase().includes(i.toLowerCase());case"greater_than":return!isNaN(o)&&!isNaN(g)&&o>g;case"less_than":return!isNaN(o)&&!isNaN(g)&&o<g;case"greater_than_equal":return!isNaN(o)&&!isNaN(g)&&o>=g;case"less_than_equal":return!isNaN(o)&&!isNaN(g)&&o<=g;default:return!0}}))),e},[Q,c,y,_]),C=x.useMemo(()=>d.key?[...X].sort((e,r)=>{let s=e[d.key],a=r[d.key];return(d.key==="current_price"||d.key==="original_price")&&(s=parseFloat(s),a=parseFloat(a)),s<a?d.direction==="asc"?-1:1:s>a?d.direction==="asc"?1:-1:0}):X,[X,d]),j=C.length,h=Math.ceil(j/S),R=(l-1)*S,Se=R+S,Z=C.slice(R,Se),H=()=>{const e=[];if(h<=5)for(let s=1;s<=h;s++)e.push(s);else{e.push(1);let s=Math.max(2,l-1),a=Math.min(h-1,l+1);l<=3&&(a=4),l>=h-2&&(s=h-3),s>2&&e.push("...");for(let i=s;i<=a;i++)e.push(i);a<h-1&&e.push("..."),e.push(h)}return e},w=e=>{e>=1&&e<=h&&(J(e),window.scrollTo({top:0,behavior:"smooth"}))},Ce=e=>{const r=parseInt(e,10);he(r),J(1)},oe=[{key:"strategy",label:"Strategy",type:"select",options:[{value:"none",label:"No Strategy"},..._.map(e=>({value:e.id,label:e.name}))]},{key:"current_price",label:"Current Price",type:"number"},{key:"original_price",label:"Original Price",type:"number"},{key:"quantity",label:"Quantity",type:"number"},{key:"minimum_price",label:"Minimum Price",type:"number"},{key:"listing_age",label:"Listing Age (days)",type:"number"},{key:"sku",label:"SKU",type:"text"},{key:"enable_auto_reduction",label:"Monitoring Status",type:"select",options:[{value:"true",label:"Active"},{value:"false",label:"Paused"}]}],$e=()=>{const e={id:Date.now(),field:"",operator:"equals",value:""};T([...y,e])},E=(e,r)=>{T(y.map(s=>s.id===e?{...s,...r}:s))},Le=e=>{T(y.filter(r=>r.id!==e))},Pe=()=>{T([])},le=e=>({image:{label:"Image",sortable:!1,width:"min-w-[80px] w-20"},title:{label:"Title",sortable:!0,sortKey:"title",width:"min-w-[200px]"},quantity:{label:"Qty",sortable:!0,sortKey:"quantity",width:"min-w-[60px] w-16"},currentPrice:{label:"Current Price",sortable:!0,sortKey:"current_price",width:"min-w-[100px] w-28"},minimumPrice:{label:"Min Price",sortable:!1,width:"min-w-[90px] w-24"},priceReductionEnabled:{label:"Price Reduction",sortable:!0,sortKey:"enable_auto_reduction",width:"min-w-[120px] w-32"},strategy:{label:"Strategy",sortable:!1,width:"min-w-[140px] w-40"},listingAge:{label:"Age",sortable:!0,sortKey:"created_at",width:"min-w-[70px] w-20"},actions:{label:"Actions",sortable:!1,width:"min-w-[120px] w-32"}})[e]||{label:e,sortable:!1};if(xe)return t.jsx("div",{className:"text-center py-8",children:"Loading listings..."});if(O){const e=(O==null?void 0:O.message)||"Unknown error occurred",r=e.includes("eBay account not connected"),s=e.includes("Authentication")||e.includes("log in"),a=e.includes("service")||e.includes("unavailable");return t.jsx("div",{className:"max-w-2xl mx-auto py-8",children:t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("svg",{className:"w-6 h-6 text-red-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.jsx("h3",{className:"text-lg font-medium text-red-800",children:"Unable to Load Listings"})]}),t.jsx("p",{className:"text-red-700 mb-4",children:e}),t.jsxs("div",{className:"space-y-3",children:[r&&t.jsx("button",{onClick:handleConnectEbay,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Connect eBay Account"}),s&&t.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Refresh Page"}),a&&t.jsxs("div",{className:"text-sm text-red-600",children:[t.jsx("p",{children:"This is usually temporary. Please try again in a few minutes."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Try Again"})]}),!r&&!s&&!a&&t.jsxs("div",{className:"text-sm text-red-600",children:[t.jsx("p",{children:"If this problem persists, please contact support."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Try Again"})]})]})]})})}return t.jsxs("div",{className:"space-y-4",children:[K&&t.jsx("div",{className:`rounded-lg p-3 border ${K.type==="success"?"bg-success/10 border-success/30 text-success":"bg-error/10 border-error/30 text-error"}`,children:t.jsx("div",{className:"flex",children:t.jsx("div",{children:K.message})})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-semibold text-theme-primary",children:"Your eBay Listings"}),t.jsx("p",{className:"text-theme-secondary",children:"Manage and monitor your eBay listing prices"})]}),t.jsxs("div",{className:"bg-theme-surface rounded-lg border border-theme p-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(Ae,{className:"h-5 w-5 text-theme-tertiary",strokeWidth:1.5})}),t.jsx("input",{type:"text",value:c,onChange:e=>b(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-theme rounded-lg bg-theme-primary text-theme-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent",placeholder:"Search listings by title, SKU, price, quantity, strategy, or any data..."}),c&&t.jsx("button",{onClick:()=>b(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:t.jsx(Ee,{className:"h-5 w-5 text-theme-tertiary hover:text-theme-primary transition-colors",strokeWidth:1.5})})]}),c&&t.jsxs("div",{className:"mt-2 text-sm text-theme-secondary",children:[j," listing",j!==1?"s":""," found"]})]}),t.jsxs("div",{className:"space-y-4 lg:space-y-0 lg:flex lg:justify-between lg:items-center",children:[t.jsxs("div",{className:"flex flex-wrap gap-2 justify-center lg:justify-start",children:[["Active"].map(e=>t.jsx("button",{onClick:()=>p(e),className:`px-3 py-2 rounded-lg text-sm font-medium flex-shrink-0 transition-colors ${n===e?"bg-accent text-white":"bg-theme-surface text-theme-secondary border border-theme hover:bg-theme-hover hover:text-theme-primary"}`,children:e==="all"?"All":e},e)),t.jsxs("button",{onClick:ge,disabled:q,className:`px-3 py-2 rounded-lg text-sm font-medium flex-shrink-0 transition-colors flex items-center gap-2 ${q?"bg-accent/50 text-white cursor-not-allowed":"bg-accent text-white hover:bg-accent-hover"}`,children:[t.jsx(qe,{className:`h-4 w-4 ${q?"animate-spin":""}`,strokeWidth:2}),t.jsx("span",{children:q?"Syncing...":"Sync eBay"})]}),t.jsxs("button",{onClick:()=>te.mutate(!B),disabled:te.isLoading||pe,className:`px-3 py-2 rounded-lg text-sm font-medium flex-shrink-0 transition-colors flex items-center gap-2 ${B?"bg-warning/20 text-warning border border-warning/30 hover:bg-warning/30":"bg-theme-surface text-theme-secondary border border-theme hover:bg-theme-hover hover:text-theme-primary"}`,title:B?"Click to resume price reductions":"Click to pause price reductions",children:[t.jsx(Be,{className:"h-4 w-4",strokeWidth:2}),t.jsx("span",{children:B?"Vacation: ON":"Vacation: OFF"})]}),(()=>{const e=n==="Ended"?C:C.filter(s=>s.quantity_available===0),r=n==="Ended"?`Close All Ended (${e.length})`:`Close All Sold-Out (${e.length})`;return e.length>0&&t.jsx("button",{onClick:fe,className:"bg-error/10 text-error border border-error/30 px-3 py-2 rounded-lg text-sm font-medium hover:bg-error/20 flex items-center gap-1 flex-shrink-0 transition-colors",title:n==="Ended"?"Close all ended listings":"Close all sold-out listings",children:t.jsx("span",{children:r})})})()]}),t.jsxs("div",{className:"flex flex-wrap gap-2 justify-center lg:justify-end",children:[t.jsxs("button",{onClick:$e,className:"bg-success/10 text-success border border-success/30 px-3 py-2 rounded-lg text-sm hover:bg-success/20 flex items-center space-x-1.5 flex-shrink-0 transition-colors",children:[t.jsx(Qe,{className:"h-4 w-4",strokeWidth:1.5}),t.jsx("span",{className:"hidden sm:inline",children:"Add Filter"})]}),y.length>0&&t.jsxs("button",{onClick:Pe,className:"bg-error/10 text-error border border-error/30 px-3 py-2 rounded-lg text-sm hover:bg-error/20 flex-shrink-0 transition-colors",children:[t.jsxs("span",{className:"hidden sm:inline",children:["Clear All (",y.length,")"]}),t.jsxs("span",{className:"sm:hidden",children:["Clear (",y.length,")"]})]}),t.jsx("div",{className:"hidden lg:block relative",children:t.jsxs("details",{className:"relative",children:[t.jsx("summary",{className:"bg-theme-surface border border-theme text-theme-secondary px-3 py-2 rounded-lg text-sm cursor-pointer hover:bg-theme-hover hover:text-theme-primary transition-colors",children:"Manage Columns"}),t.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-theme-surface rounded-lg border border-theme shadow-xl z-10",children:t.jsx("div",{className:"p-2",children:Object.entries(F).map(([e,r])=>t.jsxs("label",{className:"flex items-center space-x-2 p-2 rounded hover:bg-theme-hover cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:r,onChange:()=>je(e),className:"rounded bg-theme-primary border-theme text-accent focus:ring-accent"}),t.jsx("span",{className:"text-sm text-theme-primary capitalize",children:e.replace(/([A-Z])/g," $1").trim()})]},e))})})]})})]})]}),y.length>0&&t.jsxs("div",{className:"bg-theme-surface rounded-lg border border-theme p-4",children:[t.jsx("h3",{className:"text-sm font-medium text-theme-secondary mb-3",children:"Active Filters"}),t.jsx("div",{className:"space-y-3",children:y.map(e=>{var i;const r=oe.find(o=>o.key===e.field),s=(r==null?void 0:r.type)==="number",a=(r==null?void 0:r.type)==="select";return t.jsx("div",{className:"p-3 bg-theme-primary rounded-lg border border-theme",children:t.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:space-y-0 sm:space-x-3 sm:items-center",children:[t.jsxs("select",{value:e.field,onChange:o=>E(e.id,{field:o.target.value,operator:"equals",value:""}),className:"text-sm border border-theme rounded-lg px-2 py-1.5 bg-theme-surface text-theme-primary w-full sm:w-auto focus:ring-2 focus:ring-accent focus:border-transparent",children:[t.jsx("option",{value:"",children:"Select Field"}),oe.map(o=>t.jsx("option",{value:o.key,children:o.label},o.key))]}),e.field&&s&&t.jsxs("select",{value:e.operator,onChange:o=>E(e.id,{operator:o.target.value}),className:"text-sm border border-theme rounded-lg px-2 py-1.5 bg-theme-surface text-theme-primary w-full sm:w-auto focus:ring-2 focus:ring-accent focus:border-transparent",children:[t.jsx("option",{value:"equals",children:"="}),t.jsx("option",{value:"greater_than",children:">"}),t.jsx("option",{value:"less_than",children:"<"}),t.jsx("option",{value:"greater_than_equal",children:"â‰¥"}),t.jsx("option",{value:"less_than_equal",children:"â‰¤"})]}),e.field&&!s&&!a&&t.jsxs("select",{value:e.operator,onChange:o=>E(e.id,{operator:o.target.value}),className:"text-sm border border-theme rounded-lg px-2 py-1.5 bg-theme-surface text-theme-primary w-full sm:w-auto focus:ring-2 focus:ring-accent focus:border-transparent",children:[t.jsx("option",{value:"equals",children:"Equals"}),t.jsx("option",{value:"contains",children:"Contains"})]}),e.field&&t.jsx(t.Fragment,{children:a?t.jsxs("select",{value:e.value,onChange:o=>E(e.id,{value:o.target.value}),className:"text-sm border border-theme rounded-lg px-2 py-1.5 bg-theme-surface text-theme-primary w-full sm:w-auto focus:ring-2 focus:ring-accent focus:border-transparent",children:[t.jsx("option",{value:"",children:"Select Value"}),(i=r.options)==null?void 0:i.map(o=>t.jsx("option",{value:o.value,children:o.label},o.value))]}):t.jsx("input",{type:s?"number":"text",value:e.value,onChange:o=>E(e.id,{value:o.target.value}),placeholder:`Enter ${r==null?void 0:r.label.toLowerCase()}`,className:"text-sm border border-theme rounded-lg px-2 py-1.5 bg-theme-surface text-theme-primary placeholder-text-tertiary w-full sm:w-auto focus:ring-2 focus:ring-accent focus:border-transparent"})}),t.jsx("button",{onClick:()=>Le(e.id),className:"text-error hover:text-error text-sm p-2 hover:bg-error/10 rounded-lg flex-shrink-0 self-center sm:self-auto transition-colors","aria-label":"Remove filter",children:"âœ•"})]})},e.id)})})]}),j>0&&t.jsx("div",{className:"bg-theme-surface rounded-lg border border-theme p-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("label",{htmlFor:"items-per-page",className:"text-sm text-theme-secondary",children:"Show:"}),t.jsxs("select",{id:"items-per-page",value:S,onChange:e=>Ce(e.target.value),className:"border border-theme rounded-lg px-2 py-1 text-sm bg-theme-primary text-theme-primary focus:ring-2 focus:ring-accent focus:border-transparent",children:[t.jsx("option",{value:"10",children:"10"}),t.jsx("option",{value:"25",children:"25"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"100",children:"100"})]}),t.jsx("span",{className:"text-sm text-theme-secondary",children:"per page"})]}),t.jsxs("div",{className:"text-sm text-theme-secondary text-center sm:text-left",children:["Showing ",j===0?0:R+1,"-",Math.min(R+Z.length,j)," of ",j," listings"]}),h>1&&t.jsxs("div",{className:"flex items-center gap-1 justify-center sm:justify-end",children:[t.jsx("button",{onClick:()=>w(l-1),disabled:l===1,className:`px-3 py-1 rounded-lg text-sm transition-colors ${l===1?"bg-theme-primary text-theme-tertiary cursor-not-allowed":"bg-accent text-white hover:bg-accent-hover"}`,children:"Previous"}),H().map((e,r)=>e==="..."?t.jsx("span",{className:"px-2 text-theme-tertiary",children:"..."},`ellipsis-${r}`):t.jsx("button",{onClick:()=>w(e),className:`px-3 py-1 rounded-lg text-sm transition-colors ${l===e?"bg-accent text-white":"bg-theme-primary text-theme-secondary hover:bg-theme-hover hover:text-theme-primary"}`,children:e},e)),t.jsx("button",{onClick:()=>w(l+1),disabled:l===h,className:`px-3 py-1 rounded-lg text-sm transition-colors ${l===h?"bg-theme-primary text-theme-tertiary cursor-not-allowed":"bg-accent text-white hover:bg-accent-hover"}`,children:"Next"})]})]})}),t.jsxs("div",{className:"lg:hidden space-y-4",children:[Z.map(e=>t.jsx("div",{className:"bg-theme-surface rounded-lg border border-theme p-4",children:t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("img",{src:e.image_url||"/placeholder-image.jpg",alt:e.title,className:"w-20 h-20 rounded-lg object-cover flex-shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"text-sm font-medium text-theme-primary truncate",children:e.title}),e.ebay_sku&&t.jsxs("p",{className:"text-xs text-theme-tertiary mt-1",children:["SKU: ",e.ebay_sku]}),t.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-theme-tertiary",children:"Current Price:"}),t.jsxs("div",{className:"font-bold text-success",children:["$",e.current_price]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-theme-tertiary",children:"Quantity:"}),t.jsx("div",{className:"font-medium text-theme-primary",children:e.listing_status==="Ended"?0:e.quantity_available??0})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-theme-tertiary",children:"Age:"}),t.jsx("div",{className:"font-medium text-theme-primary",children:ie(e.created_at||new Date)})]})]}),t.jsxs("div",{className:"mt-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-theme-tertiary",children:"Minimum Price:"}),t.jsx("input",{type:"number",step:"0.01",min:"0",defaultValue:e.minimum_price||"",onBlur:r=>se(e.id,r.target.value),className:"w-24 px-2 py-1 text-sm border border-theme rounded-lg bg-theme-primary text-theme-primary placeholder-text-tertiary",placeholder:"Set min"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-theme-tertiary",children:"Price Reduction:"}),t.jsxs("div",{className:"flex items-center",children:[t.jsxs("label",{className:`relative inline-flex items-center ${(!e.minimum_price||e.minimum_price<=0)&&!e.enable_auto_reduction?"cursor-not-allowed":"cursor-pointer"}`,title:(!e.minimum_price||e.minimum_price<=0)&&!e.enable_auto_reduction?"Set a minimum price before enabling price reduction":"",children:[t.jsx("input",{type:"checkbox",checked:e.enable_auto_reduction,onChange:()=>ne(e),disabled:Y.isLoading,className:"sr-only"}),t.jsx("div",{className:`relative w-11 h-6 rounded-full transition-colors duration-200 ease-in-out ${e.enable_auto_reduction?"bg-accent":"bg-gray-200 dark:bg-gray-700"}`,children:t.jsx("div",{className:`absolute top-0.5 left-0.5 bg-white w-5 h-5 rounded-full transition-transform duration-200 ease-in-out ${e.enable_auto_reduction?"translate-x-5":"translate-x-0"}`})})]}),t.jsx("span",{className:`ml-2 text-xs ${e.enable_auto_reduction?"text-success font-medium":"text-theme-tertiary"}`,children:e.enable_auto_reduction?"Active":"Paused"})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-theme-tertiary",children:"Strategy:"}),t.jsxs("select",{value:e.strategy_id||e.reduction_strategy||"",onChange:r=>ae(e.id,r.target.value),className:"text-sm border border-theme rounded-lg px-2 py-1 max-w-32 bg-theme-primary text-theme-primary",children:[t.jsx("option",{value:"",children:"No Strategy"}),_.map(r=>t.jsx("option",{value:r.id,children:r.name},r.id))]})]})]}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[t.jsx("a",{href:e.ebay_url||`https://www.ebay.com/itm/${e.ebay_item_id}`,target:"_blank",rel:"noopener noreferrer",className:"bg-accent/10 text-accent border border-accent/30 px-3 py-1 rounded-lg text-xs hover:bg-accent/20 inline-block text-center transition-colors",title:"Open this listing on eBay in a new tab",children:"View on eBay"}),t.jsx("button",{onClick:()=>re(e.id),disabled:G.isLoading,className:"bg-error/10 text-error border border-error/30 px-3 py-1 rounded-lg text-xs hover:bg-error/20 disabled:opacity-50 transition-colors",title:"Close this listing",children:"Close"})]})]})]})},e.id)),j===0&&t.jsx("div",{className:"text-center py-12 bg-theme-surface rounded-lg border border-theme",children:t.jsx("div",{className:"text-theme-tertiary",children:"No listings found."})})]}),t.jsxs("div",{className:"hidden lg:block bg-theme-surface rounded-lg border border-theme overflow-hidden",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full table-auto divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:"bg-theme-primary",children:t.jsx("tr",{children:M.map(e=>{if(!F[e])return null;const r=le(e);return t.jsx("th",{draggable:!0,onDragStart:s=>we(s,e),onDragOver:Ne,onDrop:s=>_e(s,e),onDragEnd:ke,className:`px-2 py-3 text-left text-xs font-medium text-theme-tertiary uppercase tracking-wider ${r.sortable?"cursor-pointer hover:bg-theme-hover hover:text-theme-secondary":""} ${A===e?"opacity-50":""} ${r.width||""} select-none transition-colors`,onClick:r.sortable?()=>ve(r.sortKey):void 0,children:t.jsxs("div",{className:"flex items-center space-x-1 min-w-0",children:[t.jsx("span",{className:"flex-shrink-0 text-theme-tertiary",children:"â‹®â‹®"}),t.jsx("span",{className:"break-words leading-tight",children:r.label}),r.sortable&&d.key===r.sortKey&&t.jsx("span",{className:"flex-shrink-0 text-accent",children:d.direction==="asc"?"â†‘":"â†“"})]})},e)})})}),t.jsx("tbody",{className:"bg-theme-surface divide-y divide-gray-200 dark:divide-gray-700",children:Z.map(e=>t.jsx("tr",{className:"hover:bg-theme-hover transition-colors",children:M.map(r=>{if(!F[r])return null;const s=()=>{switch(r){case"image":return t.jsx("img",{src:e.image_url||"/placeholder-image.jpg",alt:e.title,className:"w-16 h-16 rounded-lg object-cover"});case"title":return t.jsxs("div",{className:"max-w-xs",children:[t.jsx("div",{className:"text-sm font-medium text-theme-primary truncate",children:e.title}),e.ebay_sku&&t.jsxs("div",{className:"text-xs text-theme-tertiary mt-1",children:["SKU: ",e.ebay_sku]})]});case"quantity":return t.jsx("div",{className:"text-sm text-theme-primary",children:e.listing_status==="Ended"?0:e.quantity_available??0});case"currentPrice":return t.jsxs("div",{className:"text-sm font-bold text-green-600",children:["$",e.current_price]});case"minimumPrice":return t.jsx("input",{type:"number",step:"0.01",min:"0",defaultValue:e.minimum_price||"",onBlur:i=>se(e.id,i.target.value),className:"w-20 px-2 py-1 text-sm border border-theme rounded-lg bg-theme-primary text-theme-primary placeholder-text-tertiary",placeholder:"Set min"});case"priceReductionEnabled":return t.jsxs("div",{className:"flex items-center",children:[t.jsxs("label",{className:`relative inline-flex items-center ${(!e.minimum_price||e.minimum_price<=0)&&!e.enable_auto_reduction?"cursor-not-allowed":"cursor-pointer"}`,title:(!e.minimum_price||e.minimum_price<=0)&&!e.enable_auto_reduction?"Set a minimum price before enabling price reduction":"",children:[t.jsx("input",{type:"checkbox",checked:e.enable_auto_reduction,onChange:()=>ne(e),disabled:Y.isLoading,className:"sr-only"}),t.jsx("div",{className:`relative w-11 h-6 rounded-full transition-colors duration-200 ease-in-out ${e.enable_auto_reduction?"bg-accent":"bg-gray-200 dark:bg-gray-700"}`,children:t.jsx("div",{className:`absolute top-0.5 left-0.5 bg-white w-5 h-5 rounded-full transition-transform duration-200 ease-in-out ${e.enable_auto_reduction?"translate-x-5":"translate-x-0"}`})})]}),t.jsx("span",{className:`ml-2 text-xs ${e.enable_auto_reduction?"text-success font-medium":"text-theme-tertiary"}`,children:e.enable_auto_reduction?"Active":"Paused"})]});case"strategy":return ce(e,_),t.jsxs("select",{value:e.strategy_id||e.reduction_strategy||"",onChange:i=>ae(e.id,i.target.value),className:"text-sm border border-theme rounded-lg px-2 py-1 min-w-40 bg-theme-primary text-theme-primary",children:[t.jsx("option",{value:"",children:"No Strategy"}),_.map(i=>t.jsx("option",{value:i.id,children:i.name},i.id))]});case"listingAge":return t.jsx("div",{className:"text-sm text-theme-primary",children:ie(e.created_at||new Date)});case"actions":return t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("a",{href:e.ebay_url||`https://www.ebay.com/itm/${e.ebay_item_id}`,target:"_blank",rel:"noopener noreferrer",className:"bg-accent/10 text-accent border border-accent/30 px-2 py-1 rounded-lg text-xs hover:bg-accent/20 transition-colors",title:"Open this listing on eBay in a new tab",children:"View"}),t.jsx("button",{onClick:()=>re(e.id),disabled:G.isLoading,className:"bg-error/10 text-error border border-error/30 px-2 py-1 rounded-lg text-xs hover:bg-error/20 disabled:opacity-50 transition-colors",title:"Close this listing",children:"Close"})]});default:return null}},a=le(r);return t.jsx("td",{className:`px-2 py-3 ${r==="actions"?"whitespace-nowrap text-sm font-medium":"whitespace-nowrap"} ${a.width||""}`,children:s()},r)})},e.id))})]})}),(!Q||Q.length===0)&&t.jsx("div",{className:"text-center py-12",children:t.jsx("div",{className:"text-gray-500",children:"No listings found."})}),j>0&&h>1&&t.jsx("div",{className:"mt-4 flex justify-center",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>w(l-1),disabled:l===1,className:`px-3 py-1 rounded text-sm ${l===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Previous"}),H().map((e,r)=>e==="..."?t.jsx("span",{className:"px-2 text-gray-500",children:"..."},`ellipsis-bottom-${r}`):t.jsx("button",{onClick:()=>w(e),className:`px-3 py-1 rounded text-sm ${l===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:e},`bottom-${e}`)),t.jsx("button",{onClick:()=>w(l+1),disabled:l===h,className:`px-3 py-1 rounded text-sm ${l===h?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Next"})]})})]}),j>0&&h>1&&t.jsx("div",{className:"lg:hidden flex justify-center",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>w(l-1),disabled:l===1,className:`px-3 py-1 rounded text-sm ${l===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Previous"}),H().map((e,r)=>e==="..."?t.jsx("span",{className:"px-2 text-gray-500",children:"..."},`ellipsis-mobile-${r}`):t.jsx("button",{onClick:()=>w(e),className:`px-3 py-1 rounded text-sm ${l===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:e},`mobile-${e}`)),t.jsx("button",{onClick:()=>w(l+1),disabled:l===h,className:`px-3 py-1 rounded text-sm ${l===h?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Next"})]})})]})}export{st as default};
//# sourceMappingURL=Listings-94dc143f.js.map
