import{c as q,j as e,X as b,b as y}from"./index-0231291c.js";import{r as h}from"./vendor-react-4c62d1cf.js";import{u as S,b as F,c as f}from"./vendor-query-4b12add6.js";import{P as $}from"./plus-1047e1dd.js";import{C as E}from"./check-9783a27c.js";import"./vendor-supabase-5edd3635.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],D=q("file-text",M);function L(){const n=S(),[p,m]=h.useState(!1),[x,u]=h.useState(null),[i,a]=h.useState(null),[r,d]=h.useState({name:"",reduction_type:"percentage",reduction_amount:5,frequency_days:7}),{data:c=[],isLoading:l,error:j}=F({queryKey:["strategies"],queryFn:y.getStrategies}),N=f({mutationFn:y.createStrategy,onSuccess:t=>{n.invalidateQueries(["strategies"]),o("success",`Rule "${t.name}" created successfully!`)},onError:t=>{o("error",t.message||"Failed to create strategy")}}),_=f({mutationFn:({id:t,updates:s})=>y.updateStrategy(t,s),onSuccess:t=>{n.invalidateQueries(["strategies"]),o("success",`Rule "${t.name}" updated successfully!`)},onError:t=>{o("error",t.message||"Failed to update strategy")}}),w=f({mutationFn:y.deleteStrategy,onSuccess:()=>{n.invalidateQueries(["strategies"]),o("success","Rule deleted successfully!")},onError:t=>{o("error",t.message||"Failed to delete strategy")}}),o=(t,s)=>{a({type:t,message:s}),setTimeout(()=>a(null),5e3)},k=()=>{if(!r.name.trim()){o("error","Please enter a rule name");return}if(r.reduction_amount<1){o("error","Reduction amount must be at least 1");return}if(r.frequency_days<1||r.frequency_days>365){o("error","Frequency must be between 1 and 365 days");return}N.mutate({name:r.name,strategy_type:r.reduction_type,reduction_percentage:r.reduction_type==="percentage"?r.reduction_amount:0,reduction_amount:r.reduction_type==="dollar"?r.reduction_amount:0,interval_days:r.frequency_days}),d({name:"",reduction_type:"percentage",reduction_amount:5,frequency_days:7}),m(!1)},C=(t,s)=>{const g={name:s.name,strategy_type:s.reduction_type,reduction_percentage:s.reduction_type==="percentage"?s.reduction_amount:0,reduction_amount:s.reduction_type==="dollar"?s.reduction_amount:0,interval_days:s.frequency_days};_.mutate({id:t,updates:g}),u(null)},R=t=>{const s=c.find(g=>g.id===t);window.confirm(`Are you sure you want to delete "${s==null?void 0:s.name}"?`)&&w.mutate(t)},v=()=>{d({name:"",reduction_type:"percentage",reduction_amount:5,frequency_days:7}),m(!1)};return l?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-theme-secondary",children:"Loading strategies..."})}):j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-error",children:["Error loading strategies: ",j.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold text-theme-primary",children:"Price Reduction Rules"}),e.jsx("p",{className:"text-theme-secondary mt-2 text-sm sm:text-base",children:"Create and manage automated price reduction rules for your listings"})]}),e.jsxs("button",{onClick:()=>m(!0),className:"bg-accent text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg hover:bg-accent-hover font-medium flex items-center justify-center space-x-2 w-full sm:w-auto transition-colors",children:[e.jsx($,{className:"h-4 w-4",strokeWidth:2}),e.jsx("span",{children:"Add New Rule"})]})]}),i&&e.jsxs("div",{className:`rounded-lg p-4 flex items-center justify-between ${i.type==="success"?"bg-success/10 border border-success/30":"bg-error/10 border border-error/30"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:i.type==="success"?"text-success":"text-error",children:i.type==="success"?e.jsx(E,{className:"h-5 w-5",strokeWidth:2}):e.jsx(b,{className:"h-5 w-5",strokeWidth:2})}),e.jsx("p",{className:`text-sm font-medium ${i.type==="success"?"text-success":"text-error"}`,children:i.message})]}),e.jsx("button",{onClick:()=>a(null),className:`text-sm font-medium ${i.type==="success"?"text-success hover:text-success":"text-error hover:text-error"}`,children:e.jsx(b,{className:"h-4 w-4",strokeWidth:2})})]}),e.jsxs("div",{className:"bg-theme-surface rounded-lg border border-theme overflow-hidden",children:[e.jsx("div",{className:"px-4 sm:px-6 py-4 border-b border-theme",children:e.jsxs("h3",{className:"text-lg font-medium text-theme-primary",children:["Your Rules (",c.length,")"]})}),c.length===0?e.jsxs("div",{className:"px-4 sm:px-6 py-8 sm:py-12 text-center",children:[e.jsx(D,{className:"h-16 w-16 text-theme-tertiary mx-auto mb-4",strokeWidth:1}),e.jsx("h3",{className:"text-lg font-medium text-theme-primary mb-2",children:"No rules created yet"}),e.jsx("p",{className:"text-theme-secondary mb-4",children:"Create your first price reduction rule to get started"}),e.jsx("button",{onClick:()=>m(!0),className:"bg-accent text-white px-4 py-2 rounded-lg hover:bg-accent-hover transition-colors",children:"Create First Rule"})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:c.map(t=>e.jsx("div",{className:"px-4 sm:px-6 py-4 sm:py-6 hover:bg-theme-hover transition-colors",children:x===t.id?e.jsx(A,{rule:t,onSave:C,onCancel:()=>u(null),showNotification:o}):e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mb-3",children:e.jsx("h4",{className:"text-lg font-medium text-theme-primary",children:t.name})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-theme-tertiary",children:"Reduction:"}),e.jsx("div",{className:"font-medium text-accent",children:(t.strategy_type||t.reduction_type)==="percentage"?`${t.reduction_percentage||t.reduction_amount}%`:`$${t.reduction_amount}`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-theme-tertiary",children:"Frequency:"}),e.jsxs("div",{className:"font-medium text-theme-primary",children:["Every ",t.interval_days||t.frequency_days||"?"," day",(t.interval_days||t.frequency_days)!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-theme-tertiary",children:"Created:"}),e.jsx("div",{className:"font-medium text-theme-primary",children:new Date(t.created_at).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 lg:ml-6",children:[e.jsx("button",{onClick:()=>u(t.id),className:"bg-accent/10 text-accent border border-accent/30 px-4 py-2 rounded-lg text-sm font-medium hover:bg-accent/20 w-full sm:w-auto transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>R(t.id),className:"bg-error/10 text-error border border-error/30 px-4 py-2 rounded-lg text-sm font-medium hover:bg-error/20 w-full sm:w-auto transition-colors",children:"Delete"})]})]})},t.id))})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-theme-surface border border-theme rounded-xl p-4 sm:p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-theme-primary",children:"Create New Rule"}),e.jsx("button",{onClick:v,className:"text-theme-tertiary hover:text-theme-primary transition-colors p-1 rounded-lg hover:bg-theme-hover",children:e.jsx(b,{className:"h-5 w-5",strokeWidth:1.5})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1.5",children:"Rule Name"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>d(s=>({...s,name:t.target.value})),placeholder:"e.g., Quick Sale Rule",className:"w-full bg-theme-primary border border-theme rounded-lg px-3 py-2.5 text-theme-primary placeholder-text-tertiary focus:ring-2 focus:ring-accent focus:border-transparent transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1.5",children:"Reduction Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d(t=>({...t,reduction_type:"percentage"})),className:`px-3 py-2.5 rounded-lg border text-sm font-medium transition-colors ${r.reduction_type==="percentage"?"bg-accent/10 border-accent text-accent":"bg-theme-primary border-theme text-theme-secondary hover:bg-theme-hover"}`,children:"Percentage (%)"}),e.jsx("button",{type:"button",onClick:()=>d(t=>({...t,reduction_type:"dollar"})),className:`px-3 py-2.5 rounded-lg border text-sm font-medium transition-colors ${r.reduction_type==="dollar"?"bg-accent/10 border-accent text-accent":"bg-theme-primary border-theme text-theme-secondary hover:bg-theme-hover"}`,children:"Dollar Amount ($)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-theme-secondary mb-1.5",children:["Reduction Amount (",r.reduction_type==="percentage"?"%":"$",")"]}),e.jsx("input",{type:"number",min:"1",max:r.reduction_type==="percentage"?"50":"999",value:r.reduction_amount,onChange:t=>d(s=>({...s,reduction_amount:parseInt(t.target.value)||1})),className:"w-full bg-theme-primary border border-theme rounded-lg px-3 py-2.5 text-theme-primary focus:ring-2 focus:ring-accent focus:border-transparent transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1.5",children:"Frequency (Days)"}),e.jsx("input",{type:"number",min:"1",max:"365",value:r.frequency_days,onChange:t=>d(s=>({...s,frequency_days:parseInt(t.target.value)||1})),placeholder:"Enter number of days (e.g., 7)",className:"w-full bg-theme-primary border border-theme rounded-lg px-3 py-2.5 text-theme-primary placeholder-text-tertiary focus:ring-2 focus:ring-accent focus:border-transparent transition-colors"}),e.jsx("p",{className:"text-xs text-theme-tertiary mt-1",children:"Enter any number from 1 to 365 days"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:k,disabled:!r.name.trim(),className:"flex-1 bg-accent text-white px-4 py-2.5 rounded-lg hover:bg-accent-hover disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:"Create Rule"}),e.jsx("button",{onClick:v,className:"px-4 py-2.5 border border-theme text-theme-secondary rounded-lg hover:bg-theme-hover transition-colors",children:"Cancel"})]})]})})]})}function A({rule:n,onSave:p,onCancel:m,showNotification:x}){const u=n.strategy_type||n.reduction_type||"percentage",i=u==="percentage"?n.reduction_percentage||n.reduction_amount||0:n.reduction_amount||0,[a,r]=h.useState({name:n.name,reduction_type:u,reduction_amount:i,frequency_days:n.interval_days||n.frequency_days||7}),d=()=>{if(!a.name.trim()){x("error","Please enter a rule name");return}if(a.reduction_amount<1){x("error","Reduction amount must be at least 1");return}if(a.frequency_days<1||a.frequency_days>365){x("error","Frequency must be between 1 and 365 days");return}p(n.id,a)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1.5",children:"Rule Name"}),e.jsx("input",{type:"text",value:a.name,onChange:c=>r(l=>({...l,name:c.target.value})),className:"w-full bg-theme-primary border border-theme rounded-lg px-3 py-2.5 text-theme-primary focus:ring-2 focus:ring-accent focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1.5",children:"Reduction Type"}),e.jsxs("select",{value:a.reduction_type,onChange:c=>r(l=>({...l,reduction_type:c.target.value})),className:"w-full bg-theme-primary border border-theme rounded-lg px-3 py-2.5 text-theme-primary focus:ring-2 focus:ring-accent focus:border-transparent",children:[e.jsx("option",{value:"percentage",children:"Percentage (%)"}),e.jsx("option",{value:"dollar",children:"Dollar Amount ($)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-theme-secondary mb-1.5",children:["Reduction Amount (",a.reduction_type==="percentage"?"%":"$",")"]}),e.jsx("input",{type:"number",min:"1",value:a.reduction_amount,onChange:c=>r(l=>({...l,reduction_amount:parseInt(c.target.value)||1})),className:"w-full bg-theme-primary border border-theme rounded-lg px-3 py-2.5 text-theme-primary focus:ring-2 focus:ring-accent focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-secondary mb-1.5",children:"Frequency (Days)"}),e.jsx("input",{type:"number",min:"1",max:"365",value:a.frequency_days,onChange:c=>r(l=>({...l,frequency_days:parseInt(c.target.value)||1})),placeholder:"Enter number of days",className:"w-full bg-theme-primary border border-theme rounded-lg px-3 py-2.5 text-theme-primary placeholder-text-tertiary focus:ring-2 focus:ring-accent focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:d,className:"bg-success/10 text-success border border-success/30 px-4 py-2 rounded-lg hover:bg-success/20 transition-colors font-medium",children:"Save Changes"}),e.jsx("button",{onClick:m,className:"bg-theme-hover text-theme-secondary px-4 py-2 rounded-lg hover:bg-gray-200 dark:bg-gray-700 transition-colors",children:"Cancel"})]})]})}export{L as default};
//# sourceMappingURL=Strategies-cc8598d1.js.map
