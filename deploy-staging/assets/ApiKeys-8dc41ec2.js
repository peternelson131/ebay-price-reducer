import{c as b,d as N,s as g,j as e}from"./index-0231291c.js";import{r as a,R as v}from"./vendor-react-4c62d1cf.js";import{E as _}from"./external-link-a2bb9e65.js";import{E}from"./eye-06e1df4e.js";import{L as j,C as S}from"./loader-43bf0082.js";import{C as A}from"./circle-alert-a9c91508.js";import"./vendor-supabase-5edd3635.js";import"./vendor-query-4b12add6.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],k=b("circle-x",C);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],$=b("eye-off",B);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],F=b("link-2",P);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],q=b("unlink",K),z=[{id:"keepa",name:"Keepa",description:"Required for product data, variations, and similar product search",helpUrl:"https://keepa.com/#!api",placeholder:"Enter your Keepa API key"},{id:"elevenlabs",name:"Eleven Labs",description:"Required for video auto-dubbing into multiple languages",helpUrl:"https://elevenlabs.io/app/settings/api-keys",placeholder:"Enter your Eleven Labs API key"}];function I({service:n,existingKey:o,onSave:d,onDelete:y,saving:u}){const c=o==null?void 0:o.hasKey,[i,h]=a.useState(c?"••••••••••••••••••••••••••••••••••••••••••••••••":""),[l,x]=a.useState(!1),[f,p]=a.useState(!1);return v.useEffect(()=>{c&&!f?h("••••••••••••••••••••••••••••••••••••••••••••••••"):c||h("")},[c,f]),e.jsxs("div",{className:"bg-theme-surface rounded-lg border border-theme p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-theme-primary",children:n.name}),e.jsx("p",{className:"mt-1 text-sm text-theme-tertiary",children:n.description}),e.jsxs("a",{href:n.helpUrl,target:"_blank",rel:"noopener noreferrer",className:"mt-1 text-sm text-accent hover:text-accent-hover transition-colors inline-flex items-center gap-1",children:["Get API key ",e.jsx(_,{className:"h-3 w-3"})]})]}),c&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-lg ${o.isValid?"bg-success/10 text-success":"bg-error/10 text-error"}`,children:o.isValid?"Configured":"Invalid"})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:l?"text":"password",value:i,onChange:t=>{h(t.target.value),p(!0)},onFocus:()=>{i==="••••••••••••••••••••••••••••••••••••••••••••••••"&&(h(""),p(!0))},onBlur:()=>{!i.trim()&&c&&(h("••••••••••••••••••••••••••••••••••••••••••••••••"),p(!1))},placeholder:n.placeholder,className:"w-full px-3 py-2.5 bg-theme-primary border border-theme rounded-lg text-theme-primary placeholder-text-tertiary focus:ring-2 focus:ring-accent focus:border-transparent transition-colors"}),e.jsx("button",{type:"button",onClick:()=>x(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-theme-tertiary hover:text-theme-primary transition-colors",children:l?e.jsx($,{className:"h-4 w-4",strokeWidth:1.5}):e.jsx(E,{className:"h-4 w-4",strokeWidth:1.5})})]}),e.jsx("button",{onClick:()=>d(n.id,i),disabled:u||!i.trim()||i==="••••••••••••••••••••••••••••••••••••••••••••••••",className:"px-4 py-2.5 bg-accent text-white rounded-lg hover:bg-accent-hover disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:u?"Saving...":"Save"}),c&&e.jsx("button",{onClick:()=>y(n.id),className:"px-4 py-2.5 bg-error/10 text-error border border-error/30 rounded-lg hover:bg-error/20 transition-colors",children:"Delete"})]})})]})}function L(){const{user:n}=N(),[o,d]=a.useState("loading"),[y,u]=a.useState(""),[c,i]=a.useState(!1);a.useEffect(()=>{const t=new URLSearchParams(window.location.search);t.get("ebay_connected")==="true"?(u("eBay account connected successfully!"),d("connected"),window.history.replaceState({},"",window.location.pathname)):t.get("ebay_error")&&(u(`eBay connection failed: ${t.get("ebay_error")}`),d("error"),window.history.replaceState({},"",window.location.pathname))},[]),a.useEffect(()=>{h()},[n]);const h=async()=>{try{const{data:{session:t}}=await g.auth.getSession();if(!t)return;const s=await(await fetch("/.netlify/functions/ebay-connection-status",{headers:{Authorization:`Bearer ${t.access_token}`}})).json();s.connected?d("connected"):s.status==="pending"?d("pending"):d("not_connected")}catch(t){console.error("Failed to check eBay status:",t),d("not_connected")}},l=async()=>{i(!0),u("");try{const{data:{session:t}}=await g.auth.getSession();if(!t)throw new Error("Not authenticated");const r=await fetch("/.netlify/functions/ebay-oauth-start",{headers:{Authorization:`Bearer ${t.access_token}`}}),s=await r.json();if(!r.ok)throw new Error(s.error||"Failed to start authorization");window.location.href=s.authUrl}catch(t){console.error("OAuth start error:",t),u(t.message),i(!1)}},x=async()=>{if(confirm("Are you sure you want to disconnect your eBay account?"))try{const{data:{session:t}}=await g.auth.getSession();if(!t)throw new Error("Not authenticated");const r=await fetch("/.netlify/functions/ebay-disconnect",{method:"POST",headers:{Authorization:`Bearer ${t.access_token}`}});if(!r.ok){const s=await r.json();throw new Error(s.error||"Failed to disconnect")}d("not_connected"),u("eBay account disconnected")}catch(t){console.error("Disconnect error:",t),u(t.message)}},f=()=>{switch(o){case"loading":return e.jsx(j,{className:"h-5 w-5 animate-spin text-theme-tertiary"});case"connected":return e.jsx(S,{className:"h-5 w-5 text-success"});case"pending":return e.jsx(A,{className:"h-5 w-5 text-warning"});case"error":return e.jsx(k,{className:"h-5 w-5 text-error"});default:return e.jsx(k,{className:"h-5 w-5 text-theme-tertiary"})}},p=()=>{switch(o){case"connected":return e.jsx("span",{className:"px-2 py-1 text-xs rounded-lg bg-success/10 text-success",children:"Connected"});case"pending":return e.jsx("span",{className:"px-2 py-1 text-xs rounded-lg bg-warning/10 text-warning",children:"Pending"});default:return e.jsx("span",{className:"px-2 py-1 text-xs rounded-lg bg-gray-200 dark:bg-gray-700 text-theme-tertiary",children:"Not Connected"})}};return e.jsxs("div",{className:"bg-theme-surface rounded-lg border border-theme p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[f(),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-theme-primary",children:"eBay Account"}),e.jsx("p",{className:"mt-1 text-sm text-theme-tertiary",children:"Connect your eBay seller account to create and manage listings"})]})]}),p()]}),y&&e.jsx("div",{className:`mt-4 p-3 rounded-lg text-sm ${y.includes("success")||y.includes("connected")?"bg-success/10 text-success":"bg-error/10 text-error"}`,children:y}),o==="connected"?e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-success",children:"Your eBay account is connected and ready to use."}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-3 py-2 text-sm text-error border border-error/30 rounded-lg hover:bg-error/10 transition-colors",children:[e.jsx(q,{className:"h-4 w-4"}),"Disconnect"]})]}):e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-theme-secondary mb-4",children:"Click below to securely connect your eBay seller account via OAuth."}),e.jsx("button",{onClick:l,disabled:c,className:"flex items-center gap-2 px-4 py-2.5 bg-accent text-white rounded-lg hover:bg-accent-hover disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:c?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4"}),"Connect eBay Account"]})})]})]})}function Y(){const{user:n}=N(),[o,d]=a.useState({}),[y,u]=a.useState(!0),[c,i]=a.useState({}),[h,l]=a.useState(null);a.useEffect(()=>{n&&x()},[n]);const x=async()=>{try{const{data:t,error:r}=await g.from("user_api_keys").select("*").eq("user_id",n.id);if(r)throw r;const s={};(t||[]).forEach(m=>{s[m.service]={id:m.id,value:m.api_key_encrypted?"••••••••••••••••••••••••••••••••••••••••••••••••":"",hasKey:!!m.api_key_encrypted,isValid:m.is_valid,lastUsed:m.last_used_at}}),d(s)}catch(t){console.error("Error loading keys:",t),l({type:"error",text:"Failed to load API keys"})}finally{u(!1)}},f=async(t,r)=>{if(r.trim()){i(s=>({...s,[t]:!0})),l(null);try{const{data:{session:s}}=await g.auth.getSession();if(!(s!=null&&s.access_token))throw new Error("Not authenticated");const m=await fetch("/.netlify/functions/save-api-key",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({service:t,apiKey:r.trim()})}),w=await m.json();if(!m.ok)throw new Error(w.error||"Failed to save key");l({type:"success",text:w.message||`${t} key saved successfully`}),await x()}catch(s){console.error("Error saving key:",s),l({type:"error",text:`Failed to save ${t} key: ${s.message}`})}finally{i(s=>({...s,[t]:!1}))}}},p=async t=>{const r=o[t];if(r!=null&&r.id&&confirm(`Are you sure you want to delete your ${t} API key?`))try{const{error:s}=await g.from("user_api_keys").delete().eq("id",r.id);if(s)throw s;l({type:"success",text:`${t} key deleted`}),await x()}catch(s){console.error("Error deleting key:",s),l({type:"error",text:`Failed to delete ${t} key`})}};return y?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent"})}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-semibold text-theme-primary",children:"API Keys"}),e.jsx("p",{className:"mt-2 text-theme-secondary",children:"Manage your API credentials for external services. Keys are encrypted and stored securely."})]}),h&&e.jsx("div",{className:`mb-6 p-4 rounded-lg border ${h.type==="success"?"bg-success/10 border-success/30 text-success":"bg-error/10 border-error/30 text-error"}`,children:h.text}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(L,{}),z.map(t=>e.jsx(I,{service:t,existingKey:o[t.id],onSave:f,onDelete:p,saving:c[t.id]},t.id))]}),e.jsxs("div",{className:"mt-8 p-4 bg-accent/10 border border-accent/30 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-accent",children:"Security Note"}),e.jsx("p",{className:"mt-1 text-sm text-theme-secondary",children:"Your API keys are encrypted at rest and only used to make requests on your behalf. We never share your keys with third parties."})]})]})}export{Y as default};
//# sourceMappingURL=ApiKeys-8dc41ec2.js.map
