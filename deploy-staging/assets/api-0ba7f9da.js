import{s as y}from"./index-0231291c.js";const m={}.VITE_API_BASE_URL||"/.netlify/functions";class g{constructor(){this.baseURL=m}async getAuthToken(){const{data:{session:t}}=await y.auth.getSession();return(t==null?void 0:t.access_token)||null}async request(t,e={},r=3){const o=`${this.baseURL}${t}`;let a;const i=await this.getAuthToken();for(let s=0;s<=r;s++)try{const c={headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`}:{},...e.headers},...e},n=await fetch(o,c),u=await n.json();if(!n.ok){if(n.status>=400&&n.status<500)throw new Error(u.error||`HTTP error! status: ${n.status}`);if(s<r){const l=Math.min(1e3*Math.pow(2,s),1e4);await new Promise(d=>setTimeout(d,l));continue}throw new Error(u.error||`HTTP error! status: ${n.status}`)}return u}catch(c){if(a=c,c.name==="AbortError"||c.message.includes("HTTP error!"))throw c;if(s<r){const n=Math.min(1e3*Math.pow(2,s),1e4);await new Promise(u=>setTimeout(u,n));continue}}throw a}async get(t,e={}){return this.request(t,{method:"GET",...e})}async post(t,e=null,r={}){return this.request(t,{method:"POST",body:e?JSON.stringify(e):void 0,...r})}async put(t,e=null,r={}){return this.request(t,{method:"PUT",body:e?JSON.stringify(e):void 0,...r})}async delete(t,e={}){return this.request(t,{method:"DELETE",...e})}async getPriceChanges(t=30,e=50){return this.request(`/get-price-changes?days=${t}&limit=${e}`,{method:"GET"})}async getPriceReductionLogs(t=10,e=100,r=null){const o=r?`&type=${r}`:"";return this.request(`/get-price-reduction-logs?days=${t}&limit=${e}${o}`,{method:"GET"})}async sendNotification(t,e,r,o,a={}){return this.request("/notification-service",{method:"POST",body:JSON.stringify({userId:t,type:e,title:r,message:o,data:a})})}async checkAsinCorrelation(t){return this.request("/trigger-asin-correlation-v2",{method:"POST",body:JSON.stringify({asin:t,action:"check"})})}async syncAsinCorrelation(t){return this.request("/trigger-asin-correlation-v2",{method:"POST",body:JSON.stringify({asin:t,action:"sync"})})}async triggerAsinCorrelation(t){return this.checkAsinCorrelation(t)}async startCorrelationJob(t){return this.request("/asin-correlation-job",{method:"POST",body:JSON.stringify({action:"start",asin:t})})}async getCorrelationJobStatus(t){return this.request(`/asin-correlation-job?action=status&jobId=${t}`,{method:"GET"})}async listCorrelationJobs(t=10){return this.request(`/asin-correlation-job?action=list&limit=${t}`,{method:"GET"})}async waitForCorrelationJob(t,{pollIntervalMs:e=2e3,timeoutMs:r=3e5,onProgress:o=null}={}){const a=Date.now();for(;Date.now()-a<r;){const i=await this.getCorrelationJobStatus(t);if(o&&i.job&&o(i.job),i.isComplete)return i;await new Promise(s=>setTimeout(s,e))}throw new Error("Job timed out")}async syncAsinCorrelationBackground(t,e={}){const r=await this.startCorrelationJob(t);if(!r.success)throw new Error(r.error||"Failed to start job");const o=r.jobId;return this.waitForCorrelationJob(o,e)}}const w=new g,T=w,f=(h,t="An error occurred")=>h.message?h.message:t;export{T as a,f as h};
//# sourceMappingURL=api-0ba7f9da.js.map
